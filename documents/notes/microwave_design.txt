
In order to satisfy the Barkhausen condition for oscillation, a 180 degree phase shift is required 
in the feedback loop. The inverting mosfet itself contributes the remaining 180 degrees.

The S-parameters for the CE3520K3 mosfet are listed on the manufacturer's webpage. 

qucs-RFlayout didn't recognize the QUCS file until the version ("0.0.19") was added to the
opening XML tag. #5.

----------------------------------------------------------------------------

Because of the small engraving bit diameter, we would like to etch a minimum amount of copper.

Microwaves101 says clearance of 3 line widths,
but Digi says clearance of 2 x substrate thickness.

To be safe, we'll go for 5x0.8, or 4 mm clearance.

-------------------------------------------------------------------------------------

A matching network isn't strictly necessary if the gain and VSWR are already satisfactory [mwrf]. 
The S-parameters provided by the manufacturer are given relative to a 50-ohm impedance. 

The S-parameter table shows us that at 8 GHz, the transistor does not produce the 180 degree phase
shift that was expected. The S21 mag,angle (@2v, 50 Ohm, 10 ma) varies from 4.7, 149 deg at 2 GHz to 
4.1, 62 deg at 8 GHz.

That's a clue as to why the most recent LO test didn't work.

Designing the feedback loop would be helped by some optimization, so the Qucs ASCO 4.10 optimizer 
is used. Needed to be patched: https://github.com/Qucs/qucs/issues/861

An AC sim was used in QUCS, with the F interval set to the desired interval.

Unfortunately, the gain isn't particularly satisfactory - the input of the device seems to be 
poorly matched to the output. Or perhaps this is just an artifact of the frequency-dependent 
impedance of the microstrips?

Au contrare. 

Qucs doesn't allow variables as filenames.


Simply teeing the output and feedback on the stage 1 oscillator does work, but if the 


-------------------------------------------------------------------------------------

The SMV1249 varactor in SC-79 (SOD-523) has an inductance of 0.7 nF.

----------------

IF out on the HMC220B should be AC coupled.

    
                  
      |--------------------| 6GHz                      || HackRF spectrum 
1 MHz |--------------------------------------| 12 GHz  ||
                 5 GHz |---------------------| 12 GHz  || Spectrum of interest

      |------------| 4 GHz                             || HMC220B IF range
                 5 GHz |---------------------| 12 GHz  || HMC220B RF range



---------------


Designed qucs loop into kicad. Upgraded kicad to 5.1.5 through dpkg for rounded edges.
Spacebar origin reset is very helpful.


Assembled local_oscillator.kicad. Apparent 9 ohm short across power and gnd, but ended up being
just the normal mosfet resistance. 

Refused to start up until the wires were jiggled, the voltage was increased to 2.3 V, and the current
to 0.025 A. Resonates at 5.75 GHz. Slightly affected by proximity.

There is considerable instability, however. Applying some voltage to the varactor instantly kills the
signal, no matter the osc. bias.

This is a "parallel feedback loop oscillator". 

That was with a 50 R termination on the output. Removing that dropped Fres to 5.6 GHz.

Tried putting a 30 K resistor on the gate to keep the gate bias from floating away. Refused to start
up.

Tried removing the DC block from varactor to gate, to use the existing bias trace to hold down the gate.
Putting a big solder blob on there seemed to prevent it from starting up - 
except later, I saw that when starting with 0.02 A, it steady-state transmits at 0.6V, rather than
the previous 2.3 V. 

There are a bunch of spurious tones, but the main one is much stronger than before - maybe 10x.

It's also more stable. F is still basically the same, 5.8 GHz.

Oh, putting an inductor in the alternate fb loop makes a massive difference.

Even though the OP power is only about -40 DB, the downconverter seems to be operational.

It's hard to tell what the pin diode is doing. Once the resistance is brought down a bit,
the oscillation voltage increases to 1.8v from 0.9, and all tones disappear from downconverter.
 At 0.3 A on the pin diode, the signal returns.


Huh. Is that an effect of the increased inductance to ground?

Exchanged the pin diode for a varactor. The entire spectrum lit up with -10 db signals. 

The current (and, presumably, frequency) actually tracks the HackRF LO sweep!, varying by 5% or so!

Varactor produces a very monotonic shift in F of 500 MHz over 5 V.

Ooh, all sorts of diodes exibit "varicap-like" behavior! Fantastic.

Oh, of course - the varactor isn't being biased above the amplitude, so it's going crazy.

Aha! for stability, the filter (for frequency response) and the phase shift should be optimized seperately.

"Mode hopping" - that's what the pin diode causes. No VCO-like behavior.
-

The thin 6mm FB-reflecting trace seems to actually cause a lot of problems - adds a second pole

Can use PIN diodes as a comb generator

The filter should be sharper to reject alternate modes. Proximity effect could be used to disable
osc. when too close to body?

0.2 mm x 3 mm biasing lines make a significant difference.


HOLD up! We don't need to sweep the LO - we can just use the images on the low side of the mixer
to catch the 4.5-LO GHz region! 

Our substrate thickness isn't conducive to the high-impedance choke traces needed.

I'm being very dumb. I've spent many days just trying different circuits out - learning, I suppose,
but also not being rigorous. There must be a way to design an oscillator piecewise, in a coherent 
fashion. For instance:

when a peak appears, I insert a filter. This changes the phase, so I try inserting a phase shifter-
but this introduces new resonances, etc, etc. This is no way to design a circuit.

[Wu 2013] use 100-ohm choke traces

why am I being so dumb.
 
Pretty sure the entire circuit is wrong. Most circuits have the frequency-determining component
on the drain or source. I can't model that in qucs using this S-param file.

So there's a very undesirable phase shift introduced with series capacitor at around 2-4 GHz.
This should cause ocillation at that frequency - fortunately, the gain of the amp
is very small at that F, so that should be rejected.

People have used varactors to tune across the entire frequency range, but that's pretty tricky

The capacitance of the RF Shottky diodes used varies from 0.28 to 0.22 pF. Most other diodes seem
to be around 10 pF, with the exception of a MMDL914, which goes from 0.62 to 0.55.

Hey, hang on a minute. The phase shift doesn't need to be 360 deg - it just needs to be a 
multiple of 360. As long as the FB filter response is correct, we can add phasing lines...

Loss tangent of substrate was wrong, too.

Had a quarter-wave notch filter that looked so wonderful - but one of the resonators was 100 mm long!

Quin [2017] use 51k ohm resistors as chokes at 1 GHz.

Neat construction of planar caps using mica insulators in Toyoda [1980]

A stepped-impedance tuned bandpass filter seems to be of reasonable dimensions at these frequencies.



https://forum.allaboutcircuits.com/threads/finding-power-levels-at-mixers-input.136016/
"The conversion gain, given in the datasheet, is the ratio of the power at the output to the power at the input. 
The conversion gain given in the datasheet for the LT5511 is 0dB. That means that the output power is equal to input power. 
it really couldn't be simpler. Where do integrals come into that?"

Admittance is just 1/inductance.

"documentation brigades" that trawl through scientific software repos, making notes on the theory behind
the software and providing usage and installation guides

Right now, getting a paper into a prestigious journal is linked with its "scientific quality",
perhaps partially because the peer-review process is integrated with the journal.
All of these incentives - grants, tenure, etc, is all linked with the name of the journal.

What if we made an independent peer-review system that fit into the preprint-server architecture?
Like, there's a peer-review ID that's added to the paper once it's peer-reviewed.

When writing long equations into python, comparing to the source using py2tex is extremely helpful.

SIR would probably have been better, due to the slightly better insertion loss and because of the pun.

The analytic comb version finally works; produces a very nicely tunable and very smooth filter.

Unfortunately, the phase shift is 

The gap S in the comb does not seem to have a particularly profound effect.
A filter of order 2 has an unsuitable phase shift, but 3 seems to be just right.

There is some difficulty in implementing the comb, however. Both sides must be strapped
well to the ground plane while a track of absolutely minimal length loops around - quite inconvienient.

SIRs really do have a better phase response, and can be bent in a more pleasing fashion.

"Advanced design techniques and realizations of microwave and RF filters" - doesn't have it

hang on a goddamn minute, x^2 over x? That doesn't make any sense.

Tried just scaling Kap's design by our factor. Worked fantastically, sharp res, except the resonant frequency
ended up a 24 ghz. Note: two elements were swapped. Shouldn't matter, but anyhow.

Oh wait no, it was right the first time.

Scipy's default optimizer moved only a miniscule delta, and so terminated immediately.
Switched to N-M.

Big ripple at higher modes. Just increasing the number of poles didn't help.



Colpitts-type has a really great phase response, just peachy, but the resonant f is messed up.

Unexpectedly, adding a 10 pF DC block doesn't affect phase response.

Given these parasitics, varying L just changes the resonance!

Hang on a min, aren't ceramic capacitors already varactors? 

DMM has a very convienient dBm mode.

Latest board doesn't seem to work very well.

There's another package for this varactor with a much lower parasitic inductance.

"Theory and design of " Hunter  has:

3.6 Filters with specified phase and group delay characteristics

Oh man! Part of the issue disguising the phase shift was the low freq. resolution of the sim!

When multiple 360-0 lines overlap, that's due to the resolution.

Somehow adding another cap section in series between the SIR stages sharpened the filter,
*and removed all the higher modes!* amazing!

mmm the C0G dielectric used in these small caps doesn't have much C/V dependence ("Voltage Coefficient").
in fact there's zero change! There goes that idea.

mm the 0.7 nH parasitics are actually fine.

mm no. The high-freq 12+GHz modes are amplified by the parasitics - seems to be some sort of resonance.

If capacitors are tied to ground, any small impedance has a substantial effect on the performance.
This is probably why the last test, with a 0.1 uF 0603 to ground, failed miserably.

1 mW on a 50 ohm trace is about 0.3v.

Definitely need the output to be terminated. Huge distortions otherwise.

The newest board (with bodged-in varactor bias and no varactor bias offset above operating voltage)
 has two regimes, precisely as expected from simulation;
it's stable in curent at 1.6 V 0.03 A if Vvaractor > 4 V, or about 0.8 pF.

The sweep is far smaller than expected, however - only around 0.2 GHz.
 This could be an artifact of the downconverter, but I don't think so.

The lowest frequency is also much higher than expected.
 
I can't break the sim in such a way to reproduce this. It's also getting stuck at a second mode
occasionally - adding capacitive coupling to the wierd ground dangle, adding the 1.5mm trace
at the end,

Hmm, but adding coupling from the trace to the ground plane does greatly increase the
17 GHz mode's amplitude.

Adding the ground dangle causes an issue. That might be it.

Added thick via wire from varactor to ground plane. Much more stable; no second modes.

Correction: there are now three modes. One CC limited at  0.45 V , one at 1.6 V, and one at 0.75.
Only the 0.75 V mode appears on the downconverter.

The mode that it settles in also seems to be determined by inrush current.

PSU's having a lot of trouble driving the varactors.

This would be a good time for one of those Keithley SMUs.

Adding the bias tees adds a huge mode at a few MHz. Adding the 0.2mm traces worsens the problem - 
just a direct coupling to the inductors seems to be the best. Adding a 1 K resistor where possible 
improves the situation.

Bias issues again.

Even the weakest bias coupling to the intermediate junction thingy causes huge distortion.

And removing the second varactor tee means that the other junction is now sensitive.

Putting the 0.2mm trace + inductor before the SIR filters worked a little better,
just the inductors works even better but still inadequate

leakage resistance of capacitors 

There's a technique (DSPSL) that uses a broken ground plane to create a very high impedance trace.

Adding radial stubs like in [Syrett 1980] is slightly more effective;
but the stub that's after the varactors still distorts things severely.

600 nH inductors still shift phase, but don't otherwise affect the circuit.

Aha! 10k 0402s directly off the line to a decoupled radial stub works perfectly.

Adding a small amount of inductance before the capacitor bank decreases the power in the higher modes.
mmm but that's at the cost of a gross phase shift.

Shorting C4 increases the low-frequency mode.

Adding another SIR microstrip hampers the phase response.

Realizing that I've been complacent in documenting designs and testing.

# Rev 4 LO.

Board design as committed in SIR_unit_test.sch and local_oscillator_v2. Etched. soldered. 

Much lower power consumption than previous versions. Stable startup at Vvaractor = 0, 15...

Strong, stable tone at -30 dB | 5.5 GHZ | 20v varactor bias. 

Somehow I've locked it at 2.2 GHz and can't get it back to 5. Might be an effect of the bias voltage.

Removed the shunt varactor. Now sweeps from 4.8 -5.2 GHz.

Lowpass to bandpass conversion described in "introduction to microwave circuits " 9.4
The book on microwave filters (?) had a chapter on designing fixed-group-delay filters.


oh my gosh I've been looking at the wrong phase this whole time

...no, I think I've been looking at the right one

phasing lines seem to have little dependence on width.

Using the reference hp+lp 180 deg phase shifters on Microwave101's website works.

Push-pull amps can provide wide bandwidth 

for reference,
]
sleeep is important.

Optimization seems to be improved if all the parameters are approx. of the same order.

Using basinhopping works fantastically well. A good (non-tunable) solution is found with 2 hp and 1 lp elements.
convergence is improved if more MC/stochastic steps are used 

Metal-insulator-metal (MIM) parallel-plate capacitor - that's what that one paper used -
nonlinear dielectric?

man, scipy.basinhopping is extreme. This thing just optimized 9 variables from a random guess
- in 200 iterations! 
holy crap! I didn't even know that was possible.

PIN diode switch between antenna and power sensor
mosfets and current sensing resistor on board
Only power up second stage amplifier - not oscillator - to minimize transient effects
probably need a P-channel mosfet on high-side, else grounding will be an issue


13 variables with microstrip width and length seems to be a bit much. No reasonable 
solutions found.

This optimizer will also be useful for tuning the virus simulation itself and for tuning the 
input waveform against the simulation.

Oh, and IRL! The eppenwolf and turbidimeter can be linked with the optimizer to tune the 
frequencies & polarizations IRL.

A 0.2 mm thick polyethylene substrate would use 0.58 mm traces. 0.5 is essentially identical to 
0.79 mm FR4.

A 1.5 mm overlap on a 1.5mm trace with a 0.1 mm sheet of paper (er=2.2) between has a capacitance of 
0.44 pF. This could be CNC'd in a second step?

There's a capacitor shortage. Probably doesn't matter for our use-case.

Zinc oxide is a slightly nonlinear capacitor at kilovolts of bias [Guo 2018].

--------------      - aluminized mylar, conductive ink, Graphite?
ssssssssssssss          - Kapton, mylar layer, screen printed something or other
------   ---------      - microstrip gap


1 Mohm * 1 picofarad = 1 us.

In fact, if a 0.5mm thick conductive layer was added like so:


         ||||||    ||||||
---------------    ----------------

8.8e-12 Farads/m * 5 * (1.5 mm * 0.5 mm) / (0.2 mm) = 0.165 pF

That could be solder, 

S-params are also available for the BFP620. Fantastic.

A patch antenna at 8 GHz is about 1 cm square.

Patch antenna bandwidths are only on the order of a few percent. 
U-slot patch antennas look perfect. [Wang 2008] has a design guide.


So either you can change the geometry of the antenna to make it  (trim the U, truncate a corner)
polarized, or you can feed it at two different points with a 90 degree phase shift.

[He 2015] -bbbingo dual-feed wideband U-slot. Uses vias for feed though. 

Could also just use two or four stock antennas at right angles. that'd work, very simple!

U-slot antennas want a thick substrate, however.

Writing words here doesn't give the reader a very good idea of what happened; the character is missing.

[Freundorfer 2016] uses BST film as predicted in a microstrip gap. Works reasonably well,
except the tuning range is only a few percent.

So the Q and parasitic inductance of the varactor seems to have a significant impact on the performance
of the tunable filter. This sort of makes sense;

7 GHz * 2 pi * 0.7 nH = 31 ohms of inductive reactance:
-1 / (2 pi * 7 GHz * 0.2 pF) = 113 ohms of capacitive reactance. 

"However, obtaining an octave of tuning
range in an LC tank oscillator is challenging, 
primarily because parasitic capacitances form a significant component of tank capacitance. "

Because the optimizer needs the derivative information,
we have to round to manufacturing tolerances after the sim is complete.

[Tserng 1977] talk about load resistors for maximum power output. Also, 45% efficiency. Really good paper.

They just use a single vco and inductor at the source.wtf

[Adar 1991]  

[Tsuru 2008 Fig 10] has a great chart of different wideband VCO designs.

 

 Oh, and the small SMV2019 still has 0.45 nH, not 0.2.

 10k resistors will be perfect for biasing at 1 ma (20 ohms on the pin diode), 10v

 With 3 bits in series, 20 ohms does attenuate the signal quite substantially.

 So does 10 ohms.

5 ohms requires around 3 mA - and there's two in series, so 6 mA.

undesirable effects occur when two 10k resistors are put in parallel straddling the PiNs, but
the DC blocking caps can only do 50v, and I don't want to put ones in series.

If I ever get a swelled head, please remind me that I just wasted an hour
due to having forgotten how the multimeter diode function works.


  