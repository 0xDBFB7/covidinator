

In order to satisfy the Barkhausen condition for oscillation, a 180 degree phase shift is required 
in the feedback loop. The inverting mosfet itself contributes the remaining 180 degrees.

The S-parameters for the CE3520K3 mosfet are listed on the manufacturer's webpage. 

qucs-RFlayout didn't recognize the QUCS file until the version ("0.0.19") was added to the
opening XML tag. #5.

----------------------------------------------------------------------------

Because of the small engraving bit diameter, we would like to etch a minimum amount of copper.

Microwaves101 says clearance of 3 line widths,
but Digi says clearance of 2 x substrate thickness.

To be safe, we'll go for 5x0.8, or 4 mm clearance.

-------------------------------------------------------------------------------------

A matching network isn't strictly necessary if the gain and VSWR are already satisfactory [mwrf]. 
The S-parameters provided by the manufacturer are given relative to a 50-ohm impedance. 

The S-parameter table shows us that at 8 GHz, the transistor does not produce the 180 degree phase
shift that was expected. The S21 mag,angle (@2v, 50 Ohm, 10 ma) varies from 4.7, 149 deg at 2 GHz to 
4.1, 62 deg at 8 GHz.

That's a clue as to why the most recent LO test didn't work.

Designing the feedback loop would be helped by some optimization, so the Qucs ASCO 4.10 optimizer 
is used. Needed to be patched: https://github.com/Qucs/qucs/issues/861

An AC sim was used in QUCS, with the F interval set to the desired interval.

Unfortunately, the gain isn't particularly satisfactory - the input of the device seems to be 
poorly matched to the output. Or perhaps this is just an artifact of the frequency-dependent 
impedance of the microstrips?

Au contrare. 

Qucs doesn't allow variables as filenames.


Simply teeing the output and feedback on the stage 1 oscillator does work, but if the 


-------------------------------------------------------------------------------------

The SMV1249 varactor in SC-79 (SOD-523) has an inductance of 0.7 nF.

----------------

IF out on the HMC220B should be AC coupled.

    
                  
      |--------------------| 6GHz                      || HackRF spectrum 
1 MHz |--------------------------------------| 12 GHz  ||
                 5 GHz |---------------------| 12 GHz  || Spectrum of interest

      |------------| 4 GHz                             || HMC220B IF range
                 5 GHz |---------------------| 12 GHz  || HMC220B RF range



---------------


Designed qucs loop into kicad. Upgraded kicad to 5.1.5 through dpkg for rounded edges.
Spacebar origin reset is very helpful.


Assembled local_oscillator.kicad. Apparent 9 ohm short across power and gnd, but ended up being
just the normal mosfet resistance. 

Refused to start up until the wires were jiggled, the voltage was increased to 2.3 V, and the current
to 0.025 A. Resonates at 5.75 GHz. Slightly affected by proximity.

There is considerable instability, however. Applying some voltage to the varactor instantly kills the
signal, no matter the osc. bias.

This is a "parallel feedback loop oscillator". 

That was with a 50 R termination on the output. Removing that dropped Fres to 5.6 GHz.

Tried putting a 30 K resistor on the gate to keep the gate bias from floating away. Refused to start
up.

Tried removing the DC block from varactor to gate, to use the existing bias trace to hold down the gate.
Putting a big solder blob on there seemed to prevent it from starting up - 
except later, I saw that when starting with 0.02 A, it steady-state transmits at 0.6V, rather than
the previous 2.3 V. 

There are a bunch of spurious tones, but the main one is much stronger than before - maybe 10x.

It's also more stable. F is still basically the same, 5.8 GHz.

Oh, putting an inductor in the alternate fb loop makes a massive difference.

Even though the OP power is only about -40 DB, the downconverter seems to be operational.

It's hard to tell what the pin diode is doing. Once the resistance is brought down a bit,
the oscillation voltage increases to 1.8v from 0.9, and all tones disappear from downconverter.
 At 0.3 A on the pin diode, the signal returns.


Huh. Is that an effect of the increased inductance to ground?

Exchanged the pin diode for a varactor. The entire spectrum lit up with -10 db signals. 

The current (and, presumably, frequency) actually tracks the HackRF LO sweep!, varying by 5% or so!

Varactor produces a very monotonic shift in F of 500 MHz over 5 V.

Ooh, all sorts of diodes exibit "varicap-like" behavior! Fantastic.

Oh, of course - the varactor isn't being biased above the amplitude, so it's going crazy.

Aha! for stability, the filter (for frequency response) and the phase shift should be optimized seperately.

"Mode hopping" - that's what the pin diode causes. No VCO-like behavior.
-

The thin 6mm FB-reflecting trace seems to actually cause a lot of problems - adds a second pole

Can use PIN diodes as a comb generator

The filter should be sharper to reject alternate modes. Proximity effect could be used to disable
osc. when too close to body?

0.2 mm x 3 mm biasing lines make a significant difference.


HOLD up! We don't need to sweep the LO - we can just use the images on the low side of the mixer
to catch the 4.5-LO GHz region! 

Our substrate thickness isn't conducive to the high-impedance choke traces needed.

I'm being very dumb. I've spent many days just trying different circuits out - learning, I suppose,
but also not being rigorous. There must be a way to design an oscillator piecewise, in a coherent 
fashion. For instance:

when a peak appears, I insert a filter. This changes the phase, so I try inserting a phase shifter-
but this introduces new resonances, etc, etc. This is no way to design a circuit.

[Wu 2013] use 100-ohm choke traces

why am I being so dumb.
 
Pretty sure the entire circuit is wrong. Most circuits have the frequency-determining component
on the drain or source. I can't model that in qucs using this S-param file.

So there's a very undesirable phase shift introduced with series capacitor at around 2-4 GHz.
This should cause ocillation at that frequency - fortunately, the gain of the amp
is very small at that F, so that should be rejected.

People have used varactors to tune across the entire frequency range, but that's pretty tricky

The capacitance of the RF Shottky diodes used varies from 0.28 to 0.22 pF. Most other diodes seem
to be around 10 pF, with the exception of a MMDL914, which goes from 0.62 to 0.55.

Hey, hang on a minute. The phase shift doesn't need to be 360 deg - it just needs to be a 
multiple of 360. As long as the FB filter response is correct, we can add phasing lines...

Loss tangent of substrate was wrong, too.

Had a quarter-wave notch filter that looked so wonderful - but one of the resonators was 100 mm long!

Quin [2017] use 51k ohm resistors as chokes at 1 GHz.

Neat construction of planar caps using mica insulators in Toyoda [1980]

A stepped-impedance tuned bandpass filter seems to be of reasonable dimensions at these frequencies.



https://forum.allaboutcircuits.com/threads/finding-power-levels-at-mixers-input.136016/
"The conversion gain, given in the datasheet, is the ratio of the power at the output to the power at the input. 
The conversion gain given in the datasheet for the LT5511 is 0dB. That means that the output power is equal to input power. 
it really couldn't be simpler. Where do integrals come into that?"

Admittance is just 1/inductance.

"documentation brigades" that trawl through scientific software repos, making notes on the theory behind
the software and providing usage and installation guides

Right now, getting a paper into a prestigious journal is linked with its "scientific quality",
perhaps partially because the peer-review process is integrated with the journal.
All of these incentives - grants, tenure, etc, is all linked with the name of the journal.

What if we made an independent peer-review system that fit into the preprint-server architecture?
Like, there's a peer-review ID that's added to the paper once it's peer-reviewed.

When writing long equations into python, comparing to the source using py2tex is extremely helpful.

SIR would probably have been better, due to the slightly better insertion loss and because of the pun.

The analytic comb version finally works; produces a very nicely tunable and very smooth filter.

Unfortunately, the phase shift is 

The gap S in the comb does not seem to have a particularly profound effect.
A filter of order 2 has an unsuitable phase shift, but 3 seems to be just right.

There is some difficulty in implementing the comb, however. Both sides must be strapped
well to the ground plane while a track of absolutely minimal length loops around - quite inconvienient.

SIRs really do have a better phase response, and can be bent in a more pleasing fashion.

"Advanced design techniques and realizations of microwave and RF filters" - doesn't have it

hang on a goddamn minute, x^2 over x? That doesn't make any sense.

Tried just scaling Kap's design by our factor. Worked fantastically, sharp res, except the resonant frequency
ended up a 24 ghz. Note: two elements were swapped. Shouldn't matter, but anyhow.

Oh wait no, it was right the first time.

Scipy's default optimizer moved only a miniscule delta, and so terminated immediately.
Switched to N-M.

Big ripple at higher modes. Just increasing the number of poles didn't help.



Colpitts-type has a really great phase response, just peachy, but the resonant f is messed up.

Unexpectedly, adding a 10 pF DC block doesn't affect phase response.

Given these parasitics, varying L just changes the resonance!

Hang on a min, aren't ceramic capacitors already varactors? 

DMM has a very convienient dBm mode.

Latest board doesn't seem to work very well.

There's another package for this varactor with a much lower parasitic inductance.

"Theory and design of " Hunter  has:

3.6 Filters with specified phase and group delay characteristics

Oh man! Part of the issue disguising the phase shift was the low freq. resolution of the sim!

When multiple 360-0 lines overlap, that's due to the resolution.

Somehow adding another cap section in series between the SIR stages sharpened the filter,
*and removed all the higher modes!* amazing!

mmm the C0G dielectric used in these small caps doesn't have much C/V dependence ("Voltage Coefficient").
in fact there's zero change! There goes that idea.

mm the 0.7 nH parasitics are actually fine.

mm no. The high-freq 12+GHz modes are amplified by the parasitics - seems to be some sort of resonance.

If capacitors are tied to ground, any small impedance has a substantial effect on the performance.
This is probably why the last test, with a 0.1 uF 0603 to ground, failed miserably.

1 mW on a 50 ohm trace is about 0.3v.

Definitely need the output to be terminated. Huge distortions otherwise.

The newest board (with bodged-in varactor bias and no varactor bias offset above operating voltage)
 has two regimes, precisely as expected from simulation;
it's stable in curent at 1.6 V 0.03 A if Vvaractor > 4 V, or about 0.8 pF.

The sweep is far smaller than expected, however - only around 0.2 GHz.
 This could be an artifact of the downconverter, but I don't think so.

The lowest frequency is also much higher than expected.
 
I can't break the sim in such a way to reproduce this. It's also getting stuck at a second mode
occasionally - adding capacitive coupling to the wierd ground dangle, adding the 1.5mm trace
at the end,

Hmm, but adding coupling from the trace to the ground plane does greatly increase the
17 GHz mode's amplitude.

Adding the ground dangle causes an issue. That might be it.

Added thick via wire from varactor to ground plane. Much more stable; no second modes.

Correction: there are now three modes. One CC limited at  0.45 V , one at 1.6 V, and one at 0.75.
Only the 0.75 V mode appears on the downconverter.

The mode that it settles in also seems to be determined by inrush current.

PSU's having a lot of trouble driving the varactors.

This would be a good time for one of those Keithley SMUs.

Adding the bias tees adds a huge mode at a few MHz. Adding the 0.2mm traces worsens the problem - 
just a direct coupling to the inductors seems to be the best. Adding a 1 K resistor where possible 
improves the situation.

Bias issues again.

Even the weakest bias coupling to the intermediate junction thingy causes huge distortion.

And removing the second varactor tee means that the other junction is now sensitive.

Putting the 0.2mm trace + inductor before the SIR filters worked a little better,
just the inductors works even better but still inadequate

leakage resistance of capacitors 

There's a technique (DSPSL) that uses a broken ground plane to create a very high impedance trace.

Adding radial stubs like in [Syrett 1980] is slightly more effective;
but the stub that's after the varactors still distorts things severely.

600 nH inductors still shift phase, but don't otherwise affect the circuit.

Aha! 10k 0402s directly off the line to a decoupled radial stub works perfectly.

Adding a small amount of inductance before the capacitor bank decreases the power in the higher modes.
mmm but that's at the cost of a gross phase shift.

Shorting C4 increases the low-frequency mode.

Adding another SIR microstrip hampers the phase response.

Realizing that I've been complacent in documenting designs and testing.

# Rev 4 LO.

Board design as committed in SIR_unit_test.sch and local_oscillator_v2. Etched. soldered. 

Much lower power consumption than previous versions. Stable startup at Vvaractor = 0, 15...

Strong, stable tone at -30 dB | 5.5 GHZ | 20v varactor bias. 

Somehow I've locked it at 2.2 GHz and can't get it back to 5. Might be an effect of the bias voltage.

Removed the shunt varactor. Now sweeps from 4.8 -5.2 GHz.

Lowpass to bandpass conversion described in "introduction to microwave circuits " 9.4
The book on microwave filters (?) had a chapter on designing fixed-group-delay filters.


oh my gosh I've been looking at the wrong phase this whole time

...no, I think I've been looking at the right one

phasing lines seem to have little dependence on width.

Using the reference hp+lp 180 deg phase shifters on Microwave101's website works.

Push-pull amps can provide wide bandwidth 

for reference,
]
sleeep is important.

Optimization seems to be improved if all the parameters are approx. of the same order.

Using basinhopping works fantastically well. A good (non-tunable) solution is found with 2 hp and 1 lp elements.
convergence is improved if more MC/stochastic steps are used 

Metal-insulator-metal (MIM) parallel-plate capacitor - that's what that one paper used -
nonlinear dielectric?

man, scipy.basinhopping is extreme. This thing just optimized 9 variables from a random guess
- in 200 iterations! 
holy crap! I didn't even know that was possible.

PIN diode switch between antenna and power sensor
mosfets and current sensing resistor on board
Only power up second stage amplifier - not oscillator - to minimize transient effects
probably need a P-channel mosfet on high-side, else grounding will be an issue


13 variables with microstrip width and length seems to be a bit much. No reasonable 
solutions found.

This optimizer will also be useful for tuning the virus simulation itself and for tuning the 
input waveform against the simulation.

Oh, and IRL! The eppenwolf and turbidimeter can be linked with the optimizer to tune the 
frequencies & polarizations IRL.

A 0.2 mm thick polyethylene substrate would use 0.58 mm traces. 0.5 is essentially identical to 
0.79 mm FR4.

A 1.5 mm overlap on a 1.5mm trace with a 0.1 mm sheet of paper (er=2.2) between has a capacitance of 
0.44 pF. This could be CNC'd in a second step?

There's a capacitor shortage. Probably doesn't matter for our use-case.

Zinc oxide is a slightly nonlinear capacitor at kilovolts of bias [Guo 2018].

--------------      - aluminized mylar, conductive ink, Graphite?
ssssssssssssss          - Kapton, mylar layer, screen printed something or other
------   ---------      - microstrip gap


1 Mohm * 1 picofarad = 1 us.

In fact, if a 0.5mm thick conductive layer was added like so:


         ||||||    ||||||
---------------    ----------------

8.8e-12 Farads/m * 5 * (1.5 mm * 0.5 mm) / (0.2 mm) = 0.165 pF

That could be solder, 

S-params are also available for the BFP620. Fantastic.

A patch antenna at 8 GHz is about 1 cm square.

Patch antenna bandwidths are only on the order of a few percent. 
U-slot patch antennas look perfect. [Wang 2008] has a design guide.


So either you can change the geometry of the antenna to make it  (trim the U, truncate a corner)
polarized, or you can feed it at two different points with a 90 degree phase shift.

[He 2015] -bbbingo dual-feed wideband U-slot. Uses vias for feed though. 

Could also just use two or four stock antennas at right angles. that'd work, very simple!

U-slot antennas want a thick substrate, however.

Writing words here doesn't give the reader a very good idea of what happened; the character is missing.

[Freundorfer 2016] uses BST film as predicted in a microstrip gap. Works reasonably well,
except the tuning range is only a few percent.

So the Q and parasitic inductance of the varactor seems to have a significant impact on the performance
of the tunable filter. This sort of makes sense;

7 GHz * 2 pi * 0.7 nH = 31 ohms of inductive reactance:
-1 / (2 pi * 7 GHz * 0.2 pF) = 113 ohms of capacitive reactance. 

"However, obtaining an octave of tuning
range in an LC tank oscillator is challenging, 
primarily because parasitic capacitances form a significant component of tank capacitance. "

Because the optimizer needs the derivative information,
we have to round to manufacturing tolerances after the sim is complete.

[Tserng 1977] talk about load resistors for maximum power output. Also, 45% efficiency. Really good paper.

They just use a single vco and inductor at the source.wtf

[Adar 1991]  

[Tsuru 2008 Fig 10] has a great chart of different wideband VCO designs.

 

 Oh, and the small SMV2019 still has 0.45 nH, not 0.2.

 10k resistors will be perfect for biasing at 1 ma (20 ohms on the pin diode), 10v

 With 3 bits in series, 20 ohms does attenuate the signal quite substantially.

 So does 10 ohms.

5 ohms requires around 3 mA - and there's two in series, so 6 mA.

undesirable effects occur when two 10k resistors are put in parallel straddling the PiNs, but
the DC blocking caps can only do 50v, and I don't want to put ones in series.

If I ever get a swelled head, please remind me that I just wasted an hour
due to having forgotten how the multimeter diode function works.

So, tried a simple low-pass in the last LO test.

Parts are starting to go out of stock on DigiKey.

"The oscillator was also operated in self-biased mode. As
the drain voltage is raised, the drain current increases very
rapidly at first until oscillation commences and a negative
bias develops on the gate." 

if not self-biased, they used -3v bias. interesting.


this "self-bias" idea is also present in Grebennikov.


Even MESFETs need a positive gate threshold. so why is a negative voltage required on the output?

that 9.8 ghz paper also used 

That BST varactor paper used a 1Mohm (!) resistor as a choke.

"Some principal design rules of general validity should be
respected for designing VCOS in order to avoid parasitic
oscillations at low frequencies and frequency jumps within
the effective bandwidth.
Parasitic oscillations can be avoided if care is taken
during the choice of the load and the feedback circuit in
order to force Re ( Z~ ) >0 outside of the band as far as
possible.
Frequency jumps are due to phase loops within the
band. In order to avoid such effects, we design the circuit"

Contacted some people at a microwave lab at the UofT. One said "very interesting",

the other said, approximately, "you cannot make that VCO in microstrip, you need an IC,
and it'll be expensive and just use UV."

Whenever an expert says you're wrong, it's important to very carefully consider your position and
the evidence that you have. 

And it's true that most of these designs use CMOS. 

The HB100 radar is definitely a counterexample; it's clearly a fully-microstrip design with 
an external dielectric resonator. Un-interrupted ground plane, patch antennas.
All designs seem to have shielding on the back - I guess they encountered the same proximity-effect
issues.


OOO hang on, we don't neccessarily need to modify gprMax to include qucs.
We can extract two-port parameters from gprMax for each segment of the circuit,
and add them as seperate files in qucs.

We really should have a transient sim.

Sonnet lite - looks like it's just fdtd, circuit stuff is handled seperately

Matlab RF toolbox has a S-param->spice generator, free trial

LTspice has 2-port parameters, neat

https://www.mathworks.com/matlabcentral/fileexchange/6080-s-parameter-toolbox-z-y-h-g-abcd-t
s-param toolbox

Modelithics have ADS etc models for the CEL tx and the varactor.


According to Modelithics, the CEL device can do 13.8 dBm, or 24 milliwatts.

That's the Typical Gain figure from the datasheet, but I don't think that's the actual max power output.


https://github.com/thliebig/openEMS/blob/master/matlab/examples/other/LumpedElement.m openEMS 
has a lumped element

It's possible to convert S-parameters to SPICE model via [Steenput 1999] via negative resistances,
but that 

VM of manjaro or void linux for openems

The AD8319 power sensor is only good to 12 dBm. We'd need a precision attenuator at 8 GHz.
Indeed, all the power sensors on Digikey are only good to 16 dBm (40 mW).

Mini-circuits has SMD attenuators to 43 GHz and power detectors to 8 GHz to 20 dBm (100 mW).






model_build_run.py -> solve_cpu()


Okay, so here's the deal. QUCS's S-param microstrip approximation is great.
However, they don't work with the transient sim. 

We're really not getting the full picture without a transient sim, I don't think.
Especially the grounding.

This would be so much easier if I just had Microwave Office, but
that's really not going to happen,
and all the free trials of all the programs I've found don't include the 
"coupled" part of the simulation.


.ic initial conditions looks good. .nodeset isn't it, that's just for convergence.
also https://sourceforge.net/p/ngspice/discussion/133842/thread/9ec3143b/ 
uses a voltage supply shorted to a resistor.

`reset` looks good too.

https://github.com/thliebig/openEMS/issues/54 dockerfile! wonderful!

So it looks like modifying GPRmax won't be all too onerous.
However, it might be a bit too slow for optimization. 

For this reason, it might be a good idea to first make the CEL model and try a transient 
sim. Probably with the existing qucs-python thingy.

Er, hmm


we also need need this fdtd sim if we want to use that cool interdigital design

http://openems.de/forum/viewtopic.php?t=346
the loss tangent can be modeled as a conductivity:

substrate.kappa  = 1e-3 * 2*pi*2.45e9 * EPS0*substrate.epsR;

neat!  

and the Debye dispersive module can handle wideband loss. neat!

"8.0 Availability of Practice Chips:
Assembly practice chips are available from CEL"
that's cool!

CEL has a great appnote, AN1023, talking about making SPICE models for GaAs parts.





ngspice is at /home/arthurdent/Programs/ngspice-32/install/bin/ngspice


using B620 for now, got https://sourceforge.net/p/qucs/discussion/311050/thread/700dec7a/ error

have to re-compile qucs with that change
https://github.com/Qucs/qucs/blob/master/qucs-core/src/components/devices/bjt.cpp#L779
mmmmmmmmm >:|
okay


HOld up. gprMax is a big program, but we really aren't using any of it - just a simple FDTD algo,
the scripting language, while great, isn't nearly ideal for this application, and the API
isn't really suitable for direct calls.

let's try python's fdtd!


airborne or space-based maser?


flaport/fdtd - on 'numpy' pegs a single core, does 1.75 iterations per second on a 150^3 mesh.
that's 20 mm x 20 mm at 0.2 mm/grid - perfect!


Kicad crashed, had to remove lockfiles with rm $XDG_RUNTIME_DIR/kicad/*


flaport/fdtd seems not to directly support perfect conductors, using a magnetic loss rather than
an electric one.
 
"Electromagnetic simulation using the FDTD method" -nope


1     6e7     1 0 copper

oh! no, it's fine, he's not using the H-field equs


Recent paper on Far UV shows that it might actually be safe, penetration is so low
that might be an even better method

huge lag on atom. Had to upgrade. sudo chmod 4755 /usr/share/atom/chrome-sandbox too.

using an absorbing substrate in fdtd ruins everything. Why's that
using a conductivity of 0 works fine. hmm is this a physical effect?

http://openems.de/index.php/Material_Property.html uses 'kappa' as conductivity.

Cool, ngspice supports 'CPL' coupled lines, up to 8 coupled.

Section 3.3 in the BFP620 datasheet describes a 50R system - might not even need a matching network?


Tried voltage -> voltage using the capacitor-spice method in []. doesn't really seem to work properly?
the time delay is right, but everything else is wrong. Doesn't match a spice-only transmission-line
model at all.

Perhaps should try voltage -> current. 



https://github.com/recipy/recipy
https://github.com/VIDA-NYU/reprozip
https://pythonhosted.org/Sumatra/handling_data.html

Oh hey, I should have a documentation folder with stuff like backup processes, compilation, etc

Sumatra is great, but all my scripts seem to break when put through it.


the Galaxy project is really interesting. 

scikit-rf.network has an s2y function - the conversion is really easy


file could be fed to spice using circbyline

this ngspice doesn't seem to work with timesteps < 1 ps. There is a substantial difference in the oscillation
between 2 ps and 1 ps.

ERROR:ngspyce.sharedspice:doAnalyses: TRAN:  Timestep too small; time = 1.01622e-15, timestep = 1.25e-24: trouble with node "x4.102"

oh hey, that's probably why the FDTD sim wasn't working. The timestep wasn't right!
something to re-check later.


the actual timestep is limited by ckt->CKTdelmin = 1e-11*ckt->CKTmaxStep; - 
it seems to be much, much smaller on average than the actual timestep.


modified, recompiled: 

ERROR:ngspyce.sharedspice:doAnalyses: TRAN:  Timestep too small; time = 7.55625e-11, timestep = 1.25e-64: trouble with node "x1.2"

 UH OH

 oh noes

 changed it back. modifying reltol doesn't help matters, still 'timestep too small' at tstep<1ps.

 it's not the 0-ohm shunt links, either. 

"timestep too small" is generally a result of a malformed circuit, apparently.
that circuit's in the varactor, though, so ???

[Winch 1982] hmm! there's something called a "doubling mode" oscillator, which can accomodate lower 
frequency transistors. They use 4
 NE64500 transistors with a fT of 8.5 GHz and get 19 GHz out of it. only 0 dbm, though.

so I've basically been barking up the wrong tree this whole time. 
the inductance of essentially any filter structure is too high for a 'direct' RC oscillator.

We get SUPERB stability and frequency response from just a double-tuned varactor thingy.


The ampere's law magnetic field contour thingy isn't working. IDK.

ngspice does read negative currents correctly.

The sim gets unstable when a smaller capacitance is used. interesting.

ah, the timestep is too large: (0.02 amps / 1e-15 farad * 0.3 picoseconds) = 6V.



the issue with kicad text entry just needed an pkill -o ibus-daemon
 

the nets generated by kicad will have to be split.

set num_threads doesn't make any difference.


pytorch tensor supports the 'half' type. something to look into.


ultra-micro incandescent light bulbs with a power of 0.05 w are available.
Of course, these need to produce light; at 1000 K  (BaO filament) 
(1000^4)/((2000^4)) = 0.0625x the power

0.003125 watts! that's pretty good!

that's 7.5 ma at 7.5v.

wire-bonded filament? 0.01mm nichrome is available.

cell capacitance value needs to be re-checked. 

Ciampolini 1995 iteratively try dts until convergence. They use a simple set of lumped-element 
equations, not a big, bulky SPICE sim, so that's fine. There's a significant "downshifting" effect.

This could be mitigated by better choosing the initial guess timestep.

Right now 4 iters of the SPICE takes 30 ms, while a small, coarse FDTD takes 20.
So not a huge deal, but it does mean that switching to half-precision won't make a big difference.

the two transistor pins are the squeaky wheels that get the timestep. wierd. adding an rshunt doesn't 
do anything.

yeah, the transistor pins are doing this:

NETU10 6.32961368560791 1929.1538000106812
NETU12 -6.32961368560791 -1929.1538000106812

wack.

RE1 33 31 1E-03
RE2 33 32 1E-03

that's probably why.


Run one SPICE step, then iterate until equilibrium.

Trim the excess copper?

_FORTIFY_SOURCE -cool

The BFP620 has a larger heatsinking lead on the second emitter pin. The thick
50-ohm output trace should be connected to that.

That makes it refuse to oscillate, and I CBA to figure out why. The oscillator
won't need dissipation anyhow - the buffer amp will be the hot bit.

copper tape as jumper?

Digikey sells cool little SMD jumpers. 

maybe I've always been attacking this via problem the wrong way in the past. We really just need 
to jump over traces - jumpers on the solder side are pretty well perfect?

OOOh! Modular design!


ah - the fast, switching P-mos for pulses can be after the slow, regulated supply.

make a fault tree for a Type 1 error state, to make sure we're not drawing the wrong conclusions


The pads were too large on all the 0402 parts.


oh my god. I figured out why the sim wasn't working. NONE OF THE PADS ARE IN THE RIGHT PLACE.

rudimentary buck converter. It's a terrible idea to feed an RF device with a switching supply;
all the noise will be injected into the carrier. It's fine in this case I think though.

nah, using an NPN now.

The RF power detector becomes really non-linear at beyond -10 dB; that means three
10 dB attenuators would be required in series. 

We should probably compare with a SPICE sim of the RF shottky rectifier.

It would be interesting to combine boundary-scan with SPICE. Correlate nets with pins,
apply random impulses, see how the output compares.
There would be a concept like "hardware test coverage"; how much of the hardware has been exhausted


Infineon AN_1807 is really neat, on using diode detectors for power sensing. Ez pz, no complex
matching networks required like [Tan 2018] use.

"Furthermore, PN junction diodes are
minority semiconductor devices suffering from the low recombination velocity of the minority carriers in the
space charge region, whereas Schottky diodes are controlled by the charge transport over the barrier from the
majority carriers. This leads to very fast switching action for the Schottky diodes and makes them very
attractive for RF and microwave rectification."

Neat! We can use the AD chip to leapfrog-calibrate the Infineon chip, comparing with SPICE.

en532276.pdf great paper on EEPROM longevity.
"This is a quantum-mechanical process known as Fowler-Nordheim tunneling. The key to this
tunneling is that the electrons barely disturb the oxide layer, so the process can be repeated millions
of times. A flash cell uses a different programming technique, called Channel Hot Electron
Programming, that damages the oxide layer with every write. That’s why E2’s have much higher
endurance than flash, which is usually specified to only 10,000 cycles."

"To expand on that last point, we at Microchip are very proud of our endurance."


p-channel foldback 


okay, so, we want to ramp the frequency over a 0.1 us pulse.


Adding another mosfet to discharge the LP filter cap,
10 uF * 1 ohms = 10000 ns, so that's not going to do it.

the DAC doesn't seem to be capable of producing nanosecond pulses.
the external DACs that I have can't either.

Using a 10 nF cap on each rail now.



ghrr usb linux pki silly LAN grumble grumble

lxi discover 
lxi screenshot --address 192.168.0.26 --plugin rigol-1000z

works great.


there's no capacitance on the 48V rail input. should be fixed

It would be very interesting to do a FOIA request to see how the Curiosity Rover peeps do 
hardware checkout.

Dipole (toroidal emission pattern) and monopole antennas can easily be made with appropriate
bandwidth and gain.

There was sufficient gradient information in the QUCS simulation for optimization. 

man, infineon is cool! they supply a "Budgetary Price €/1k" for their devices. 

The BAT15 shottky SPICE model is only valid to 6 GHz. That sux.

darnit, that infineon appnote used the BAT15-02EL, whereas I've only got BAT15-03s. dagnabbit


ZX47-40-S+ looks like the right power detector.


flaport/fdtd only seems to use 36% of the GPU capacity, even though cprofile sez


   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
   1014/1    0.004    0.000   13.785   13.785 {built-in method builtins.exec}
        1    0.000    0.000   13.785   13.785 U_patch_antenna_designer.py:1(<module>)
        1    0.005    0.005   11.272   11.272 U_patch_antenna_designer.py:71(sim_VSWR)
     1000    0.010    0.000   11.264    0.011 sources.py:117(FDTD_step)
     1000    0.061    0.000    5.395    0.005 grid.py:275(update_E)
     1000    0.061    0.000    5.366    0.005 grid.py:301(update_H)
     6000    4.356    0.001    4.356    0.001 boundaries.py:449(update_phi_H)
     6000    4.316    0.001    4.316    0.001 boundaries.py:421(update_phi_E)
     2063    0.002    0.000    1.653    0.001 backend.py:214(zeros)
     2063    1.649    0.001    1.651    0.001 {built-in method zeros}

I think that means it's being way less efficient with PCIe transfers. 

nvvp:

            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   31.03%  1.24629s    137000  9.0970us  3.0720us  1.2425ms  _ZN2at6native6legacy18elementwise_kernelILi128ELi4EZNS0_15gpu_kernel_implIZZZNS0_15add_kernel_cudaERNS_14TensorIteratorEN3c106ScalarEENKUlvE_clEvENKUlvE2_clEvEUlffE_EEvS5_RKT_EUliE2_EEviT1_
                   13.62%  547.06ms     65008  8.4150us  1.5350us  195.96us  _ZN2at6native6legacy18elementwise_kernelILi128ELi4EZNS0_15gpu_kernel_implIZZZNS0_21copy_device_to_deviceERNS_14TensorIteratorEbENKUlvE_clEvENKUlvE2_clEvEUlfE_EEvS5_RKT_EUliE2_EEviT1_
                   13.43%  539.44ms     76000  7.0970us  2.2720us  1.2233ms  _ZN2at6native6legacy18elementwise_kernelILi512ELi1EZNS0_15gpu_kernel_implIZZZNS0_15add_kernel_cudaERNS_14TensorIteratorEN3c106ScalarEENKUlvE_clEvENKUlvE2_clEvEUlffE_EEvS5_RKT_EUliE0_EEviT1_
                   10.62%  426.53ms     50012  8.5280us  2.3680us  59.198us  _ZN2at6native6modern29vectorized_elementwise_kernelILi4EZZZNS0_15mul_kernel_cudaERNS_14TensorIteratorEENKUlvE_clEvENKUlvE2_clEvEUlffE_NS_6detail5ArrayIPcLi3EEEEEviT0_T1_
                    8.38%  336.49ms     64008  5.2560us  2.5920us  595.02us  _ZN2at6native6legacy18elementwise_kernelILi512ELi1EZNS0_15gpu_kernel_implIZZZNS0_21copy_device_to_deviceERNS_14TensorIteratorEbENKUlvE_clEvENKUlvE2_clEvEUlfE_EEvS5_RKT_EUliE0_EEviT1_
                    6.41%  257.38ms     49000  5.2520us  2.9120us  151.58us  _ZN2at6native6legacy18elementwise_kernelILi128ELi4EZNS0_15gpu_kernel_implIZZZNS0_15mul_kernel_cudaERNS_14TensorIteratorEENKUlvE_clEvENKUlvE2_clEvEUlffE_EEvS5_RKT_EUliE2_EEviT1_
                    5.24%  210.31ms      3000  70.103us  65.214us  83.773us  void thrust::cuda_cub::core::_kernel_agent<thrust::cuda_cub::__parallel_for::ParallelForAgent<thrust::cuda_cub::__transform::unary_transform_f<thrust::permutation_iterator<thrust::device_ptr<long>, thrust::transform_iterator<strided_range<thrust::device_ptr<long>>::stride_functor, thrust::counting_iterator<long, thrust::use_default, thrust::use_default, thrust::use_default>, thrust::use_default, thrust::use_default>>, thrust::permutation_iterator<thrust::device_ptr<long>, thrust::transform_iterator<strided_range<thrust::device_ptr<long>>::stride_functor, thrust::counting_iterator<long, thrust::use_default, thrust::use_default, thrust::use_default>, thrust::use_default, thrust::use_default>>, thrust::cuda_cub::__transform::no_stencil_tag, idx_functor, thrust::cuda_cub::__transform::always_true_predicate>, long>, thrust::cuda_cub::__transform::unary_transform_f<thrust::permutation_iterator<thrust::device_ptr<long>, thrust::transform_iterator<strided_range<thrust::device_ptr<long>>::stride_functor, thrust::counting_iterator<long, thrust::use_default, thrust::use_default, thrust::use_default>, thrust::use_default, thrust::use_default>>, thrust::permutation_iterator<thrust::device_ptr<long>, thrust::transform_iterator<strided_range<thrust::device_ptr<long>>::stride_functor, thrust::counting_iterator<long, thrust::use_default, thrust::use_default, thrust::use_default>, thrust::use_default, thrust::use_default>>, thrust::cuda_cub::__transform::no_stencil_tag, idx_functor, thrust::cuda_cub::__transform::always_true_predicate>, long>(thrust::device_ptr<long>, thrust::device_ptr<long>)




huh. 


python module.__file__  is neat.


Upgrading pytorch increased utilization to 41%, not super great.

half-precision - the E field is of the right magnitude, but the H-field
needs to be scaled.

dammit, no change on V100! setting cudnn.benchmark = true doesn't change anything.
only 18% utilization.

hmm, this is a particularly small mesh, only 50x50x50 or so.

I mean, there would still be a massive speedup if transfers weren't occuring
there is probably something in my code that's forcing a copy of some sort.

tried a 64-core machine with OMP_THREADS set, no go.

python -m torch.utils.bottleneck doesn't yield anything enlightening.

--------------------------------------------------------------------------------
  autograd profiler output (CPU mode)
--------------------------------------------------------------------------------
        top 15 events sorted by cpu_time_total

--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
Name                  Self CPU total %  Self CPU total   CPU total %      CPU total        CPU time avg     CUDA total %     CUDA total       CUDA time avg    Number of Calls  Input Shapes                         
--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
slice                 66.82%           61.782ms         66.82%           61.782ms         61.782ms         NaN              0.000us          0.000us          1                []                                   
select                13.47%           12.456ms         13.47%           12.456ms         12.456ms         NaN              0.000us          0.000us          1                []                                   
slice                 6.93%            6.411ms          6.93%            6.411ms          6.411ms          NaN              0.000us          0.000us          1                []                                   
slice                 3.54%            3.270ms          3.54%            3.270ms          3.270ms          NaN              0.000us          0.000us          1                []                                   
size                  1.71%            1.582ms          1.71%            1.582ms          1.582ms          NaN              0.000us          0.000us          1                []                                   
index_put_            0.86%            792.870us        0.86%            792.870us        792.870us        NaN              0.000us          0.000us          1                []                                   
_index_put_impl_      0.85%            787.119us        0.85%            787.119us        787.119us        NaN              0.000us          0.000us          1                []                                   
nonzero               0.79%            728.690us        0.79%            728.690us        728.690us        NaN              0.000us          0.000us          1                []                                   
index_put_            0.77%            710.295us        0.77%            710.295us        710.295us        NaN              0.000us          0.000us          1                []                                   
_index_put_impl_      0.76%            704.874us        0.76%            704.874us        704.874us        NaN              0.000us          0.000us          1                []                                   
slice                 0.71%            658.297us        0.71%            658.297us        658.297us        NaN              0.000us          0.000us          1                []                                   
nonzero               0.70%            651.735us        0.70%            651.735us        651.735us        NaN              0.000us          0.000us          1                []                                   
index_put_            0.70%            643.129us        0.70%            643.129us        643.129us        NaN              0.000us          0.000us          1                []                                   
index_put_            0.69%            641.685us        0.69%            641.685us        641.685us        NaN              0.000us          0.000us          1                []                                   
_index_put_impl_      0.69%            635.184us        0.69%            635.184us        635.184us        NaN              0.000us          0.000us          1                []                                   
--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
Self CPU time total: 92.455ms
CUDA time total: 0.000us

--------------------------------------------------------------------------------
  autograd profiler output (CUDA mode)
--------------------------------------------------------------------------------
        top 15 events sorted by cpu_time_total

	Because the autograd profiler uses the CUDA event API,
	the CUDA time column reports approximately max(cuda_time, cpu_time).
	Please ignore this output if your code does not use CUDA.

--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
Name                  Self CPU total %  Self CPU total   CPU total %      CPU total        CPU time avg     CUDA total %     CUDA total       CUDA time avg    Number of Calls  Input Shapes                         
--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
view                  35.57%           25.179ms         35.57%           25.179ms         25.179ms         35.56%           25.202ms         25.202ms         1                []                                   
select                6.11%            4.323ms          6.11%            4.323ms          4.323ms          6.10%            4.322ms          4.322ms          1                []                                   
mul                   4.84%            3.427ms          4.84%            3.427ms          3.427ms          4.84%            3.428ms          3.428ms          1                []                                   
slice                 4.78%            3.385ms          4.78%            3.385ms          3.385ms          4.80%            3.403ms          3.403ms          1                []                                   
sub                   4.77%            3.380ms          4.77%            3.380ms          3.380ms          4.77%            3.381ms          3.381ms          1                []                                   
slice                 4.69%            3.319ms          4.69%            3.319ms          3.319ms          4.70%            3.330ms          3.330ms          1                []                                   
slice                 4.57%            3.238ms          4.57%            3.238ms          3.238ms          4.59%            3.252ms          3.252ms          1                []                                   
slice                 4.57%            3.232ms          4.57%            3.232ms          3.232ms          4.56%            3.232ms          3.232ms          1                []                                   
slice                 4.49%            3.182ms          4.49%            3.182ms          3.182ms          4.51%            3.193ms          3.193ms          1                []                                   
index_put_            4.46%            3.156ms          4.46%            3.156ms          3.156ms          4.45%            3.156ms          3.156ms          1                []                                   
_index_put_impl_      4.43%            3.136ms          4.43%            3.136ms          3.136ms          4.43%            3.139ms          3.139ms          1                []                                   
slice                 4.39%            3.108ms          4.39%            3.108ms          3.108ms          4.39%            3.109ms          3.109ms          1                []                                   
select                4.15%            2.936ms          4.15%            2.936ms          2.936ms          4.14%            2.936ms          2.936ms          1                []                                   
slice                 4.11%            2.910ms          4.11%            2.910ms          2.910ms          4.11%            2.910ms          2.910ms          1                []                                   
slice                 4.07%            2.883ms          4.07%            2.883ms          2.883ms          4.07%            2.883ms          2.883ms          1                []                                   
--------------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  -----------------------------------  
Self CPU time total: 70.792ms
CUDA time total: 70.876ms


need to remember to delete the GPU boot disk.


Computing the power through the source resistor didn't seem to be right,
found a paper describing an fourier method that also cuts way down on the number of iterations.
great!
just take the fourier transform of the current and voltage, and divide the two.
they use a gaussian derivative function (hermitian function?). I'm not sure why.

Another paper also talks about the current measurement geometry. good stuff.

it seems like most of the good papers on the fdtd method can be found by filtering <1998.
since then, HFSS and ADS have become so prevalent that the methods aren't even discussed 
anymore.

because the sample frequency required by the courant limit is so high, most of the fft 
is way higher than our region of interest. If we sub-sample a small fraction, 
the freq goes down.

hmm no that's stupid

whatever

ah fuck it was in the PML

noise was caused by the huge scaling factor in the gaussian.

no! it's not stupid! [Furse 2000]
"“Desampling” has be en used to minimize the computational
requirements o f Fourier transform computations [14], " 

ooh, there's also an uneven fft. 


every time I test the analysis part of this program, I re-run the simulation. that's stupid and slow.
But there's a lot of state I might need, and there's really no reason why I'll need to persist 
any of this data after. using dill to persist the whole session, then reload.
a game changer!

try:
    dill.load_session(filename)
except:
    voltages, currents = sim_VSWR(pcb, freqs)
    dill.dump_session(filename)

works fantastically.



25 dBm ->
 Audio industory:
  0.316228 W in 600 Ohm registance
  13.7745 V rms across 600 Ohm
 Television industory:
  0.316228 V rms across 75 Ohm
  0.00133333 W
Radio frequency engineering:
  3.97635 V rms across 50 Ohm
  0.316228 W

the bat63 doesn't have a spice model. the bat1504W does, but doesn't specify valid freq.
15-02 doesn't.
the bat62 does, but I can't get it.



using a sine excitation doesn't help. fft's working fine though!

was off by a factor of mu0:

>>> 1 V / (0.01 T * 0.01 m) -> ohms

  1 V / (0.01 T × 0.01 m) ➞ Ω

  Conversion error:

    Cannot convert unit V/(T·m) (base units: m·s⁻¹)
                to unit Ω (base units: A⁻²·kg·m²·s⁻³)


>>> mu0 * 1 V / ( 0.01 tesla * 0.01 m) -> ohms

  mu0 × (1 V / (0.01 T × 0.01 m)) ➞ Ω

   = 0.0125664 Ω


so, after adding all the right scaling factors, we match up with [Samaras 2004]
by 5% or so, and agree with simple analytic methods by 20%. that's good enough for me!


we should compare the conductivity of the nutrient broth and the phage broth...


this fourier technique is also used in electrochemistry - fourier impedance spectroscopy.


650 obs - 163 desired
400 obs - 11 desired
750 obs - 240 desired
377 obs - 0 desired

after the simulation is complete, but before any analysis takes place,
 transfer the whole dataset into global state, and 
persist the whole simulation sessionwith dill. Ideally, this would be stored along with the
file used to create it and the parameters, so that the analysis can be re-run 
with slightly changed parameters.



okay, so the final answer is; subtract the vacuum permittivity, divide by 2.
 

Trying to find an anti-static material (less dusty than wood) for use as the surface.

trimming the initial pulse doesn't work - obvs, since the voltage is zero after the pulse!

feels like we might be running into the limits of float32 precision. 

the discrepancy between float32 and float64 runs is about 2e-9. Given that our signal 
is 1e-6 or so, that's plausible?






Saving a little bit of some design effort by using a few op-amps as the feedback loops for
the voltage and current controllers. 

This is especially useful because the FreqCount library depends on a lack of interrupts,
and a regular PID update interrupt would have to be disabled for a spell during capture.

Quite a bit of noise in the loop at about 10-50 khz. 

Adding capacitance to the servo loop actually harms noise performance, which I guess makes sense.


Accidentally put 5v into the Teensy briefly. oooooooops. still seems to be working, however.

Adding capacitance to the op-amp input makes no difference. Adding a 1k series resistor to the
mosfet base also
doesn't help.

adding capacitance after the series resistor doesn't do it.

Adding 100 nF at the output does just fine - 40 mV.
heh, that's 0.1uf.

ooo! openHTF!

huh, so how do we solve voltage follower instability? 

Adding 50r to the top of the MOSFET didn't help either.

man, I am so friggin incompetent. It's the simplest possible circuit! 

there's an interesting disconnect here; we're using this teensy just so we can monitor a few analog
voltages and set a few values, but now we need to target two separate platforms
(the spect. analyzer on the PC side and the ) and define a nice and reliable interface.

that's garbage. Ideally we'd have an RPi with GPIO, one codebase, logging direct to files rather
than through a serial port, etc...

or a DAQ card on the main computer here - something specifically not NI-visa based.

 that would actually be a neat paradigm - very close to a PXI chassis, but woke.

So, TLV9062, 5k to ground, 20k to positive to properly scale for the DAC, 
output to mosfet voltage follower, 200 nF on the output, and like 100 mV of noise.
Best-case, that causes ~30 MHz freq. modulation of the output.

could use some sort of high-voltage buffer amp, but of course we can't use that in the final design
and I'd like to work all the kinks out now if possible

Screw this. Let's do a PID.

Erm, on second thought; the LO doesn't need to sweep very rapidly, so we're okay with an extra few
uF on that. The 

-----------------------------------------

what were the mistakes that they made in the DNA resonance paper? How do we prevent them?

Reviewing the Foster paper on the technique.

First, Edwards used a reflection method, sticking a cut piece of coax into a container
of the solution. Radiation effects were not accounted for. Foster use a transmission method 
like Yang.


> and care was taken to ensure
that the frequency range included the frequency corresponding to one 
quarter of a wavelength in the sample, a prerequisite for accurate
measurements.


"This process was repeated using several samples of varying thickness,"

-----------------------------------------

Looking for a pre-built protocol, doesn't seem like there is one.
https://github.com/PHaroZ/arduino-snap

                
can persist program state after each segment of the experiment so as to restart

the mlx90621 has a 60x16 deg FOV. 

hey... the CD is conductive. We could totally CNC conductors onto it.



The peak transistor collector voltage of 2V should only give us 40 milliwatts.
does that mean we have to couple to 10 ohms or something and then match back to 50?

oh, and Vpk is probably only 0.75V (Vpk vs Vpp).

P = (0.707 * Vpk) ^ 2 / R



I think so. Okay, no problem, 1/4 wavelength 25r line on the collector might do it

hm, no - we need a wideband impedance transformer to do that - stubs perhaps?

ah, damn. So even though our active device 
can totally do some hundreds of mW, 

ooh, but what if we cascode? Then our applied voltage
can be 4 or even 6 V, and we don't need a huge 25 ohm trace and appropriate matching.

yeah, looking online, cascoding applies equally well
to RF circuits.

we need a so-called shunt-feedback cascode.

Awesomesauce!

The CEL device has a safe operating range up to 3.3 V - a swing of 1.5 V, still only 40 mW.

Oh, we also have that crazy-expensive device. What's that again? Ah, MWT-173

That can do 250 mW at 5V.

Looking back at our ngspice oscillator sim, the voltage swing on the output of the 
Z50 transmission line is as expected,
varying from 1.44 V at 6 GHz to 2.18 at 10 GHz. 

The voltage directly on the cathode is quite different, however, wiggling from 
2 to -3 volts, which is very concerning. Poor matching, I suppose?

TX power is therefore
 

for validation of this issue, [Leuschner 2010]:

Generating
high RF power from low supply voltages poses also another
problem: the optimum load impedance of the PA output
stage transistors becomes very small. A matching network
with a high transformation ratio is needed to transform the
antenna impedance of 50 to the optimum load impedance.
High transformation ratios usually result in small bandwidth and higher losses. Possible solutions are the use of
either non-standard high power RF devices or special circuit
topologies using only the available standard devices.


oh neat, one paper altered the applied base voltage to set the impedance match. That's cool!

Indeed, changing the oscillator sim base bias to 0.7v improves the matching significantly - 
at the cost of slightly lower output power of course.

[Sowlati 2002]

"Reported CMOS power amplifiers have DC voltage below
the recommended voltage, but DC+RF voltage levels exceeding
this value [4]. In this circumstance, the output power of the
amplifier degrades up to 1dB after continuous operation for
70-80 hours [5]"

oh, wow! Okay, a burn-in test is required.

"G2 follows the RF signal at D2 in both
positive and negative swings around its DC value. This is suitable for Class AB/B design, where the signal has roughly the
same positive and negative variations around the supply voltage."

"However, in Class E power amplifier design, the voltage swing
can be about three times the supply voltage (with a larger positive variation than negative around supply),"

We're definitely not a class E amp - just a class A. 

Including the jupyter with 'standalone' didn't work, so via pdf has to do.

"jupyter nbconvert optical_centrifuge.ipynb --no-input --to pdf"

there need to be no spaces after the $$ math mode entry in jupyter, else
Latex gives an error.

One issue with jupyter notebooks is that they seem to encourage a sort of non-modular
coding. 

The resonant frequency is not the optimal excitation frequency because of the second term
in the sqrt. 

"Candidates for the local maximum and minimum in some interval are 
1. Critical points 
2. the endpoints 
3. (not applicable since our function is continuous and well-behaved)"


The distribution of the breaking force has a profound effect on the electric field.


The e-field distribution model shows that 

The oscillator has an OP power of about 10 mW, as would be expected. 
Matching with L-section has very little impact on the OP power.

this cascode technique is also known as a "HiVP" or "Stacked amplifier" technique.

neat - Class D purely switched amps are common in RF PAs too.

Matching the stacked amplifier with a L-stub ind+cap designed in QUCS using the datasheet
smith chart does work, but 
In the BFP620 datasheet they give a curve at 3V, which would be over the Vceo limit.
looking into this,
The max voltage situation is much more complicated in BJTs than in mosfets.
At a high enough collector voltage, the base is pulled high through an internal
diode, the transistor turns on and is essentially shorted (Vceo.)

This is that '2.3v' breakdown voltage rating.

However, the Vces - shorted base breakdown voltage - is 7.5V.

SPICE BJT models don't seem to include breakdown voltages.


Using a capacitive BJT biasing like in https://www.jstage.jst.go.jp/article/elex/advpub/0/advpub_10.20130470/_pdf
gets us some of the way there. It's really sensitive to the biasing sharing between the
two amplifiers.

/RF power amplifiers/, someone:

"If V0 = Vdc, the peak instantaneous collector voltage is 2Vdc, and the
peak instantaneous collector current is 2Idc. The power output capability of
the Class A amplifier is therefore 0.125".

That sucks!




2.3.2 Amplifier Biasing
The impedance of the circuitry biasing the base is critical to the voltage
handling capability of a bipolar device [30]. At high V ce, impact-ionization in the
base-collector junction (large reverse bias) generates excess holes that are swept
into the base region (reverse base current). With an open base (high impedance
bias), the reverse current is injected back into the emitter increasing the collector
current. This promotes impact-ionization (positive-feedback) and leads to early
breakdown (BVCEO ≈ 1.8 V in this process). A low impedance biasing circuit that
can source and sink current (behave as voltage source), drains the reverse base
current, increasing the breakdown voltage to BVCES ≈ 5.5 V. Simulations of the
unit PA with shorted base (Fig. 2.7) indicate a reverse DC base current of 0.25 mA
(for the bottom devices) at full power.


Aha! 


Using 4-layer stackups can provide a thinner substrate [CuriousMarc],
or even flex processes [Dharmon].


With a sufficiently low-impedance bias, then, we should be able to run a single transistor up to
5 V.

Infineon has an entire appnote about this problem, AN003.pdf. 

We've also been ignoring one possible optimization route: the power is pulsed.

"Active antenna"

Turning off the amplifier power has the expected result.

If the base impedance is made low enough that runaway is unlikely (150r or so), the input match is too 
poor 

the 1.2V "Vebo" spec is the peak /reverse/ voltage allowed; the clue is in the order of the 
E-B-O - in all other specs the positive goes first, so this would be -1.2v on the base.
That makes more sense.

"It has since been shown that reverse breakdown of the B-E junction, even if current limited, causes long time beta degradation."
, widlar claimed otherwise

The limiting value then becomes the 3 mA max base current.

putting a sense resistor on the base, we're pushing 14 milliamps on the amplifier. that's no good.

Aha. The gain (Fig. 9) at 6 GHz is only 10 dB. If we're putting in a 10 dBm signal,
we can only hope to get perhaps 17 dBm - 40 mW, 4v p-p.

The CEL device has a gain of 12 dBm over frequency.

The BFP540 has a base current of 8 mA and a Vceo of 5v. 
The MCH4020 doesn't even list the max base current.MCH4020

We could even get away without the switchable attenuators and downconverter;
we don't need to transmit at full power with the SA in place. 

SMP connectors like 1868-1116-ND‎look perfect for this use.

All the low-freq. components can be removed by subtracting a sample with the LO off.

The diode detector has a fall time of 10 us, much too slow for our purposes.
It would be possible to pull down the output with a fet, sort of like a chopper amp - 
to get better performance

The impedance of the diode detector circuit is 0 in the steady-state! We still have to terminate
with 50 ohms before! How strange that the BAT15 appnote didn't do that.

Temperature compensation in the diode detector is not required above 0 dBm.

The on-off switch can be capacitive; when it's put on, it turns on.

The attenuator could be automatic - comparator on the diode detector, 

If the impedance of the diode detector is truly infinity at steady-state, we don't need to switch
it in and out of the circuit; it can just be constantly hanging off the amplifiers.

a 100pF capacitor on the detector 

chrome --js-flags="--max_old_space_size=XXX"
or --max_old_space_size
might fix the ppapi pdf viewer issue

have some spare lm317-like regs, figured they'd have better power dissipation
aldfja;sdfljk lsdkfj aldkf j
starts up at max voltage rather than the other, which sucks

The current sense amp is too slow. durn.


" However, for
pulsed waveforms, especially those of a low duty factor, the thermal crossover can extend to much higher
frequencies (in the megahertz region). This standard contains criteria to protect against adverse electrostimulation effects for pulsed waveforms having fundamental frequencies above 100 kHz. "

C95.1-2005

Neither ICNIRP nor IEEE specifiy e-field restrictions above 6 GHz.

"f) For exposures to pulsed RF fields in the range of 100 kHz to 300 GHz, the peak pulse power densities are limited by the use of time averaging and the limit on peak E field, with one exception: the
total incident energy density during any one-tenth second period within the averaging time shall not
exceed one-fifth of the total energy density permitted during the entire averaging time for a continuous field (1/5 of 144 J/kg), i.e.,"

C95.1-2005 Annex B, "Identification of levels of RF exposure responsible for adverse
effects: summary of the literature", has an excellent overview 

oh, here's a gold quote:

"Further examination of the RF literature reveals no reproducible low level (non-thermal) effect that would
occur even under extreme environmental exposures. The scientific consensus is that there are no accepted
theoretical mechanisms that would suggest the existence of such effects. This consensus further supports the
analysis presented in this section, i.e., that harmful effects are and will be due to excessive absorption of
energy, resulting in heating that can result in a detrimentally elevated temperature. The accepted mechanism
is RF energy absorbed by the biological system through interaction with polar molecules (dielectric relaxation) or interactions with ions (ohmic loss) is rapidly dispersed to all modes of the system leading to an
average energy rise or temperature elevation. Since publication of ANSI C95.1-1982 [B6], significant
advances have been made in our knowledge of the biological effects of exposure to RF energy. This
increased knowledge strengthens the basis for and confidence in the statement that the MPEs and BRs in this
standard are protective against established adverse health effects with a large margin of safety."

The results of the recent modelling of the inactivation threshold over frequency 
show that (depending on the value of *k*) a wideband VCO sweep is of little importance. 
It is unfortunate that this was discovered so late in the project, 
since a great deal of time was spent trying to make everything
broadband. When one frequency can be assumed, you have many more tools in the RF toolbox;
quarter-wavelength lines are well-behaved, patch antennas need not be broadband, etc.

need to fix the mu dx/dt scale factor in the FDTD<->SPICE sim.

Silicon carbide has a distinctive absorption spectrum between 8 and 12 GHz.
30% b/w SiC to epoxy makes a nice 7 GHz reference [Ting 2016].

Maintain consistent pin naming

the downconverter could probably be replaced with a diode mixer.

"
An unbalanced mixer, in addition to producing a product signal, allows both input signals to pass through and appear as components in the output.
A single balanced mixer is arranged with one of its inputs applied to a balanced (differential) circuit so that either the local oscillator (LO) or signal input (RF) is suppressed at the output, but not both.
A double balanced mixer has both its inputs applied to differential circuits, so that neither of the input signals and only the product signal appears at the output.[1] Double balanced mixers are more complex and require higher drive levels than unbalanced and single balanced designs."

cool!

On youtube, some dude has built a 20 GHz oscillator on breadboard

amazing

I'm spending so much time on just getting a simple communication bus between the host and the teensy.
deframing, reliable CRC, 
In one case, I need to send a 32x64 array from the thermal imager to the host.

There's this machine, screaming along at 3.5 GHz, with plenty of space and interface
for logging and all manner of minutia,
and yet I'm connecting this tiny little restrictive device to it just so I can turn some pins on
and off?

That's crazy.

Parallel ports can do MHz with low latencies; the linuxcnc machine here already does this!
 It's probably possible to run everything here through a shift register and an ADC,
mock out all the Arduino GPIO to use the parallel port, and run everything natively. 

PCI cards would also do it, of course.

A suitably-powerful RPi-like device could probably do this.
There are even preempt-RT kernels for RPi!

Injection-locked oscillators look pretty fine.

https://rust-embedded.github.io/cortex-m-quickstart/cortex_m_quickstart/ rust looks great!

Even debian has a modern realtime kernel! Neat!
https://packages.debian.org/search?keywords=linux-image-rt

https://buy.advantech.com/Buy-Online/bymodel-PCI-1710.htm

advantech has a few pcie cards < $150, but they're all really slow.

PicoEBD FPGA looks really good - only 4 IOs, but they're all probably very fast.

https://www.versalogic.com/product/serial-i-o/
this looks like a good option

https://github.com/torvalds/linux/blob/master/drivers/gpio/gpio-amdpt.c wow! Looks like that's
the X370 driver!

Intel has a tightly-coupled "PCH platform controller" with some gpio.

there's something called a 'Super I/O bus' controller.

ooh, maybe I should have used an esp32.

"As already known [9],
due to the fi eld-spread ing factor 1 R , the peak of the radiated
power density did not occur at the focal point (where all fi eld
contributions sum in phase, due to the proper aperture phase
tapering), but the peak occurred at a point between the antenna’s
aperture and the focal point (at a distance R0 from the antenna’s
plane)."

they also say the effect of the antenna element radiation pattern itself is quite small
The dipole far-field equation is a good fit.

"Thus high power densities require small spots, which are
produced by large antennas at short wavelengths. Power
density (PD) is, for any focused antenna (Bickmore and
Hansen, [41): "
Aha!


[Hansen 1985] Eq. 9 with the exact phase approximation of (19) looks good. The other approximation described only works for arrays > 20 lambda.

maybe we should simplify this a bit. Use [Sun]'s microstrip absorption thing, but
use a linear sliding cuvette rather than the centrifugal technique. That way we don't need antennas, the whole thing can go in an oven,
easier to replicate with SARS, no issues with 
alignment.
 The one disadvantage is the aeration and mixing, and possibly hetrogeneity 

ballpoint pen springs to maintain consistent pressure

hey, oxy acetylene torch oxygen is probably sterile, right? we can bubble with that

shipping from mini-circuits is $100. That sucks.

ah yes, so the Yee lattice current is just averaged. That impedance equation with 2V/ i1 i2 is
just what you get when you average ohm's law.

email prof. shariar about artifacts

for bsl, use piezo and cell phone microphone to get data out

got NaNs again. Numpy has an errormode function, pytorch has an anomaly_detect function.

Neither seemed to work, but manually narrowed it down to overlapping objects.
Report issue to flaport: objects overlap causes nan

Conductivity and impedance of broth changes with bacterial growth!

"The resonant frequency is represented by , is the relative
permittivity, is the quality factor and is the resonant
frequency difference. Previous studies have shown that
bacteria and other microbes have dielectric properties[6].
Hence relating the dielectric constant of the bacteria and the "

"change in the dielectric constant when the bacterial count is in
the range 1 to 4. Hence the sensor is sensitive enough to detect
Escherichia coli cells as low as 1 bacterial cell in 50 µL of the
sample. " WHAT

WHAAAAAT

what?

[Yuen 2009] do it the other way around; cut double-sided tape and stick two layers of Mylar on either side. They also use a "cutting mat".

Mylar is apparently autoclaveable! Neat!
Cutting mylar on the plotter is a bit tricky, but doable. Definitely need a backing
pad - cardstock worked fine; however, using adhesive definitely blocks all the channels.


ah! a level curve! Take the partial derivatives of the E-field function, 
https://math.stackexchange.com/questions/382748/partial-derivative-with-maxima,
set all three to zero 
(???)


"a well-designed
circuit will not be dependent upon initial conditions for
proper operation.)"

They're talking about noise, but I like to think they're talking more about a multivac-like initial condition.

Injection locked arrays can do +- 20 degrees. That's a 7 cm line at 10 cm.
Good enough for a test, I guess.

Ah, but that's with a linear phase progression, whereas we need a parabolic phase. 

Pytorch couldn't allocate memory; had to close paraview, even though plenty of GPU mem remained.
strange!

flaport/fdtd is giving wierd results for absorbing boundaries; and the update equations don't
seem to correspond to those in other textbooks. Section 4.1.7 in his thesis discusses.


In flaport/FDTD, object coefficients are not updated if the timestep is updated after
grid registration. 

Using the equations from 

        Lossy media update equation coefficients stolen from

        Inan, Umran S., and Robert A. Marshall. Numerical electromagnetics: the FDTD method. Cambridge University Press, 2011.
        eq. 4.24b, page 91

        and

        Schneider, John B. "Understanding the finite-difference time-domain method."
        School of electrical engineering and computer science
        Washington State University (2010): 28.
        Chapter 3.12


hang on, from flaport's thesis current density is J du / sqrt(eps0)

Aha! Flaport uses different normalized units! Genius! Discussed in section 4.1.2

0.001 / sqrt(eps0)

Man, failure to draw the correct conclusions lurks behind every corner. This would have completely invalidated our simulations.

implementation ripped back out, flaport's is totally correct:

        # TODO: FIXME: Object coefficients are not updated if the timestep is altered after registration.

        super()._register_grid(grid=grid, x=x, y=y, z=z)
        self.coefficient_1 = (2.0 * (self.permittivity*VACUUM_PERMITTIVITY) - self.conductivity * self.grid.time_step) /\
                                (2.0 * (self.permittivity*VACUUM_PERMITTIVITY) + self.conductivity * self.grid.time_step)
        self.coefficient_2 = (2.0 * self.grid.time_step) /\
                                ((2.0 * self.permittivity*VACUUM_PERMITTIVITY) + (self.conductivity * self.grid.time_step))

    def update_E(self, curl_H):
        """ Custom update equations for inside the absorbing object

        Lossy media update equation coefficients stolen from

        Inan, Umran S., and Robert A. Marshall. Numerical electromagnetics: the FDTD method. Cambridge University Press, 2011.
        eq. 4.24b, page 91

        and

        Schneider, John B. "Understanding the finite-difference time-domain method."
        School of electrical engineering and computer science
        Washington State University (2010): 28.
        Chapter 3.12

        """
        # TODO: FIXME: Object coefficients are not updated if the timestep is altered after registration.
        loc = (self.x, self.y, self.z)
        self.grid.E[loc] *= self.coefficient_1
        self.grid.E[loc] += self.coefficient_2 * curl_H[loc]


flaport:

"This is just me trying to post-hoc an excuse for such an idiotic mistake, 
but it might be useful to mention that a conductivity in Siemens should 
be normalized by 1 / (dx / eps_0) as per your thesis"


Now here's an idea. There's already papers on using liquid metals to make antennas. What if we use saline to make microstrips? Then the circuit can be reconfigured at will, 
phase shifters can be made 


Density of epoxy is about the same as water, so 30% w/w SiC should be fine.

One layer of mylar will be sufficient - 0.45 mm 

mention safesump inc. conflict of interest otherwise.

sudo ln -s /home/arthurdent/Programs/julia-1.4.2/bin/julia /usr/bin/

a scaled, trimmed sine wave might be close to the parabola function. 



OOOOOOh wait

X-rays, but hard to control phase for interference and hard to modulate - terahertz,
hard to generate

There's a so-called optical window in the near-ir. Either two interfering beams, or 
modulating one beam.

[Zhang] uses chicken breast to test. 

Consider racial differences in absorption.

Still seems like penetration depths above 3 cm are unlikely.

austinman tissue frequency http://sites.utexas.edu/austinmanaustinwomanmodels/am-faq/#change



What features do we want?


Bottom:

capacitive sensor 
hole for turbidimeter, turbidimeter
hole for 
heater trace
Lowpass filter
ambient thermistor
Near and far-end power sensors

FLuidic:

alignment pins on all layers
space to flush down with argon
Laser cut well #, plate #

cencoder notch a specified distance from cuvette centerline





SiC (isolated well)



Top:

led for turbidimeter
IR led for encoder
hole for microbolometer
transmission power sensor?
capacitive sensor ground electrode


Later, m



raised antenna on second board stacked above first? 

we'll have to measure conductivity separately, I think. graphite is a common material for sensor 
electrodes; but I can't think of how we can measure it.

Silver is definitely out.

It's possible to determine the conductivity from the capacitance; but it looks hard.


Could use a solenoid to clamp the fluidic disc -  eh, nah


Takes 7 amps to heat a 1mm trace to 120 C
https://www.4pcb.com/trace-width-calculator.html


It would be nice to be able to simulate the pneumatics of the microfluidic system
before it's built.

These Mesa Electronics fpga cards look badass! 
LinuxCNC has a packaged debian 9 RT kernel - the stock debian one is probably better though


There are too many citations to just dump at the end of the document. I want to
duplicate the Zotero 'collection' tree format in the LaTeX.


https://citeas.org/api

tried to install biblatex via
tlmgr install biblatex
turns out a bunch of the old mirrors were broken, had to run 
tlmgr update --self
and then 
tlmgr install biblatex
a few times.

BibLatex export with Better Bibtex threw an error; restarted Zotero and it was fixed.

Using a Zotero Better Bibtex postscript now

nextCollection only goes one way, and it's already exhausted
Args passed 
            cache = this.postscript(this, this.item, translator_1.Translator, Zotero);


Switched from gummi to texstudio for biblatex. This bibliography is awesome though

To refresh all cite keys, select all, select "refresh keys", then select one or two and refresh.

Using a "bifurcating (BF) distributor".

We may want the ability to run headless; to ship the card to some BSL3 lab and have a spectrum 
taken, without needing a computer. We won't need the spectrum analyzer for that case.
The codebase should be set up for this.

We could just PiN-diode switch the exposure cuvette rather than mechanically
moving the slide. That might be an option for the future.

Ethanol precipitation to find free DNA


Don't forget the lipid bilayer, and don't forget the genome!

Synthesize a metric involving 



USB stopped working after plugging in the laser cutter webcam.
Used 'sudo dmesg -wH' to get the xhci id (0000:00XXXXXXX), then used
echo -n "0000:00:XXX.xXxx" | sudo tee /sys/bus/pci/drivers/xhci_hcd/unbind
echo -n "0000:00:XXX.xXxx" | sudo tee /sys/bus/pci/drivers/xhci_hcd/bind
to reactivate.

Microfluidics: small channels, big headaches.

Use corded drill as a centrifuge for mixing -
no! Use palm sander!

eee

probably would have been a good idea to use the 3mm substrate for the fluidic chip.

The screw on the linear slide can be extended. The magnet is just glued on.

The dead volume of the slide might affect the measurement.

275 mm/min, 20krpm, 0.8 mm step-down does such a good job on the exterior milling of the
PCB.

450 mm/min works very well on this black cardstock.



Draw a little sharpie mark as the registration point?


Now this is a tricky problem. We want to be able to run the board headless, just in case
we have to bring it to a BSL lab. However, we also need to get data
from the oscope etc; so which of the devices should be the host?

Man, serilization sucks!

Binary: needs deframing, not human readable.

Protocol buffers: where do we put the checksum? Implementations are pretty messy and
will cause bugs.


there must be a better way to do this sort of thing.

Some UWB antennas have notches for the outlawed regions of the FCC standard;
this one does not appear to.

Finally broke through the mental block I had on looking up the citations of the Li 2009 paper.
One paper discusses with reference to COVID: no mention of pulsed.

The area of the microstrip is some 0.75 cm^2. That's larger than I had expected, but
should be okay.


TMC driver isn't working for some reason. Might relate to the use of software SPI on the teensy

Swapped R1/R2 on the BOB. Didn't seem to work?

Ah, it's because of the current limit. The current limit doesn't go low enough!

Works now.

Slide can get stuck when at the motor end extreme. Have to home against the other extreme.

PLA bearing surfaces on the preload plate were a little scratchy. Added some teflon film.

Swapped out the LED for a higher brightness one.

Homing using the same thing is pretty tricky. Going to add a separate sensor.

Stallguard doesn't seem to be working. It only updates once every *full* step, but still doesn't
seem to provide a good enough result.

The CD slide that I tore apart used a little IR flag. Slapped an analog IR reflectance sensor
on a digital pin there, called it a day. Works great. Repeatability is less than 1 thou.

Okay, so the reason why this worked is that when I tightened the screw on the reflectance sensor,
it broke an SMD resistor. Amazing.

Maximize orthogonality for prototyping, minimize orthogonality for production. 
By trying to use the same sensor for homing and turbidity, we complicated matters.


take the derivative=0 of the fast_turbidity reading for the fine alignment?

Having the board like this makes servicing more difficult.

Yang don't mention how the spectrometer was calibrated.

Tried using literal programming to integrate protocol with code. Not super great.

Small amount of misalignment with the cuvette; needs a little bit of tweaking from the ideal 5mm spacing.
Obviously it would have been ideal if I'd just 
properly added the IR alignment holes to the design, but whatever.
Right now we're trying to maintain alignment from one home pos over 80mm,
rather than the distance from each ir hole to each cuvette.

Seems like I used a capacitor rather than an inductor when building the wideband pa.
Fixing now.

Important that parts be put on the right way around for identification.

There's a hell of a lot of noise on the supply to the wideband pa. adding 100uF fixes it.

The other bias leg is fine.

PA works now. Drifts just like the LO.

PA is pretty choppy / hole-y and isn't drawing a huge amount of current. 

Might be because of the 100r resistor?

Removing the slide changes the frequency response.

Okay, wtf?

The slightest load brings the supply down to 2v. wtf?

Ah, I had put an artificial limit on the voltage.

Neither of the LOs work properly now.

Screw this. We need a better tuner than this; something with a crazy high Q, 
where we don't need to worry about drift or whatever.

The HMC732 is a nice 6-12 GHz VCO. Only three of the pins are used, so it
wouldn't be that hard to use. It's about $200 apiece.

\cite{Tunable2010} has a nice review of different tuning techniques.
Mechanical is particularly useful because it's orthogonal to electrical.

\cite{Wideband1981} describe using a 1/4 wavelength stub in an open-ended cavity to tune.

\cite{WaveguideCavity1982} it's particularly useful because cavities allow easy power combining.

\cite{Study2014a}, F is unaffected by radii; the radii affect the C and L, changing the quarter-wavelength length,

phase/distance = 2 pi * F * sqrt(L * C)

Where C = 2 pi e0 / ln(b/a), 
L = mu 0 

where b is the inner rad of outer and a is the outer rad of inner.

As the quarter-wave length gets very small, Q drops.

Whoa! Ferrite permeability tuning is awesome! \cite{MicrostripTunable2009} - this one
uses magnetite.

oh, that's just a YIG!

MSW Straight Edge Resonator 

https://web.mit.edu/22.09/ClassHandouts/Charged%20Particle%20Accel/CHAP12.PDF

Unfortunately, cylindrical resonators don't just have one mode; there's a sometimes interfering
progression as length changes.

Holy crap they just sell cheap 15 GHz synths! lmx2595 apparently among others

HMC732

Alright. So. I can buy a HMC732.

# Let's review.

We've just found a few papers that talk about exactly we're doing here; but there's no *Data*.
To begin a viable test, we need to actually take data.

To test in the field, we will need pulsed microwave power.

The phage lysis assay won't work on SARS. The typical PCR sars test won't work either.

It's possible that the spectrum will change once the virus is broken. This itself might 
be an effective assay. We need to test this on the bench.

We really do need that VCO.

If the CNC can't do the QFN package, could bondwire.

The power levels aren't enough on their own

Somehow one of the inductors on the LO got disconnected. Fixed. 

Thought maybe the LO had drifted overnight, but actually I'd just forgotten to turn on the power.


SA works great now, except the power output of the VCO is abysmal - or perhaps this design
of rf dtector is just 100x less sensitive? 

Replaced resistor on VCO with 50 ohms.


Now, it's useful to backtrack and wonder why we decided to make our own VCO.

First, we had not yet gotten the data showing that a broad frequency sweep isn't particularly important
to the inactivation power threshold.

Therefore, everything was designed with ultrawideband techniques in mind.

Additionally, the "electromagnetic mask" form factor (requiring a cheap oscillator) is now secondary
to the "direct exposure", high-pulse-power treatment. This probably won't use semiconductor devices at all!

 Threshold isn't as important as before because of the pulsed/



Rather than switching components in and out of the feedback loop, couldn't we just switch 
entire oscillators (+filters, even) for each frequency band? If we want to span 1 GHz 

Frequency multiplying +filtering seems pretty tricky.

Removed the inductors from both varactor legs on VCO. Now the circuit is very stable, tunes from 
7 to 6.4 GHz.

Re-added inductor on the collector. Unstable again.

Removed varactor and coupling cap from base. Nothing. 

One of the diodes on the base is definitely the wrong way around. darnit!

Flipped it around, (stock Wideband LO + 0.6 nH) draws a lot of current but not obviously any RF power.

with 0.6 nH, no cathode varactor, sweeps from 6.4 to 6.6 GHz (??)

### Coaxial tuned oscillators.

Dielectric

This technique goes way back.



Tunable coplanar waveguide

1/4-wave air coax is 15 mm at 5 ghz and 8 mm at 10GHz.

the‎LMX2595 is amazing, but it looks like there's a lot of supporting stuff to use it properly.
While it doesn't need the HV supply, it does need an XO or other 100MHz oscillator.

In that sense the HMC732 is simpler to use.

"13 GHz Frequency Counter Prescaler" - really neat! This'll be way easier than the SA.

Rather than using a PiN-switch or motorized slide, we could just get the operator to drop the cuvette into place
in different positions - metal pins for registration?

A temp-controlled plate reader could be used instead of this convoluted LTOF converter.
Sufficiently small microplates might have a small enough volume - spacing by two might work
384-well plates have a volume of 40 uL, diameter 3.3 mm, 
1536-well plates have a diameter of 1.7 mm
https://www.perkinelmer.com/lab-products-and-services/application-support-knowledgebase/microplates/plate-dimensions.html
Flat-bottom or optical "low well base" plates look suitable, have a 200 uL bottom film.

Apparently 1536-well plates are hard to work with. 

Might work with the 1.6 mm substrate 3mm 50Z trace or a wideband 25Z trace?


Write a checklist of things to test

All three power sensor types

The -6 dBm, 0.15v p-p output of the div-8 is just below the input thresholds of the 
div4. Need to amplify that up.


Add fuse if battery powered

Soldered the HMC732. That's nerve wracking!

Putting a little dot of ink on the side of a non-castellated QFN where the pins start
helps alignment.

If the device you're using shows the internal schematic, 
after soldering, doing a quick diode test to see if the values correspond is very helpful.
Had to push the QFN down a bit to seat.


The power output of the HMC732 varies greatly with, decreasing as temp increases.

Built up the VCO drivers and everything. This 5-24v step-up converter does a nice job. 

Somehow #define -ing just before a function caused a runtime fault. what a weird error!
No, misdiagnosed. IDK.

Noise on the output of the 20v regulator is un-measurable. Very nice. 
However, that's totally swamped by the noise on the DAC. Seems to be caused by the noise on the
3.3V rail.  
Added a lin. reg to the DAC 3v3, no change. Removed all capacitance at the output of the op-amp.
18 mV of noise now. Perfection.

The DAC wasn't responding. The MCP4725 has 0b1100 + two address bits + A0: adafruit seems to order
parts with 10, whereas digikey uses 00. 

I thought I wouldn't need to turn off the LO, but actually this way we can't differential
the SA. Darnit.

At first it looked like something was dramatically wrong; everything was a mess, there were 
tones everywhere, nothing corresponded to the varactor voltage, current draw was way higher than expected. 
Had an existential crisis thinking that perhaps RF is way more complex than I had made it out to be; maybe
you need to be way more careful to get any result at all; 

then noticed that the varactor voltage was wiggling around a bunch, circa 500 mV. Added a 10k in series, 

If noise has such a profound effect on the performance, perhaps the homebrew LO *was* actually working
it just was noisy as all hell.

Maybe we can tolerate 5k / 5k on PiN diodes. Then we can use the 24V rail.

The amplifier drew so much current that the linear reg went into overtemp shutdown.
Stuck a heatsink onto it and dropped the voltage, now it's back.

Getting a maximum of 21 mV with the simple inductor bias + BFP620,
where the 1 dBm output of the sig. gen is 20 mV.

Swapped out the BFP620 for the CEL mosfet. Got to 50 mV output before it started smoking.

Had accidentally commented out the part that constrained the output voltages, so all the previous
tests were at 10V.

Swapped out one of the bias inductors for a 50R resistor. Much lower power output - 27 mV.

Swapped out for one of the MWT-173 devices, and put back the two inductors. @5v, ~100 mW input,
0.25v output (nice!).

This even though the gain is only 10 dB. Strange - probably need to add a second gain stage.

Almost no variation in o-p power over the whole freq. range.

Reg. still floated above the setpoint; added 440 ohms to the output, now it's perfect.

With this MWT amp, there are two regimes: 0.5v output one, and a 0.05v output one.
I think it might be oscillating at 7 or so GHz, and that's causing the increase in gain
without needing the multiple stages.

There are definitely three modes that it's hopping between.

It's hard to tell on the SA. The LO is really intermittent now for some reason.
Fixed, set LO tuning to 1.0.

Removed the MWT, swapped for a CEL. At 0, 0, 6, 1, 0.15v from one sensor and -0.09 from the other??
Tried again, got 0.24 on one and -0.09 on the other

Dude. This is so cool. Disconnected the VCO from the amplifier and fed it straight into the downconverter.
There are a few resonance modes here that I don't like. By putting my finger over the 
feed, I can damp the modes. Super cool.


Turning on the power, the whole noise floor increases;
background peaks rise by 10db or so. 

Using a blank SMA connector as a probe works great.
Using this technique, found that the amp is oscillating at about 4 GHz. Correction, that's 10 GHz.

The tone appears whenever the VCO is txing. It's not obviously caused by the mosefet.

Adding a series resistor can apparently help damp these issues;
poor grounding can also cause it.

There's about 70 mV of noise on the supply.

Should disconnect each segment, terminate, and probe to see if it's causing the noise and pops.

Ah the chrome pdf problem seems to be related to the cache - 

Y'know, the output levels on the HMC732 aren't really right. Directly connected to the hackrf,
there's 0db of gain, we're at -60 dB - not at all what I would expect. Maybe a pin isn't connected?

Directly connecting the output probe to the terminated end power sensor, we get 0.12v; about 0.2 dBm,
which is the right order of magnitude.

The hackrf still picks up WiFi properly. 

This hackrf + downconverter really isn't working for me. It's impossible to determine what's what, levels
are off by -40 dB, etc, etc.

The power detector output lead seems to have some RF on it; by putting my finger in various
positions, there's a sine superimposed on it.

Anything over 5V definitely blows the CEL fets.

Even with two fet gain stages, still can't get above 0.22 V on the power sensor.

The notched lead of the MWT-173 is the gate.


With CEL -> MWT 2 stage amp, got 0.5 Vpp on one power sensor, and -0.3 on the other power sensor.

Rise time on the supply is about 400 ns, on the power sensor is more like 600 ns.

With this setup, the minimum pulse duration is about 400 ns - that seems to be limited by DigitalWrite
Fast, actually.

The hardware seems to be capable of 280 ns fwhm. 

Paraffin melts at 37c - perfect phase-change regulator for bacteria?

Using CPWG means we can tune the size of the waveguide; unfortunately, the
fringe field might be smaller.

Apparently randomization is generally a good idea. Unfortunately, we're below where the central-limit
theorem would start to take effect; at least two runs would be required.


In coplanar waveguide it's apparently a good idea to 50-ohm terminate with two 100-ohm resistors, 
one to each ground plane.

Ah! the vias are required to prevent "parallel plate modes" in cpwg.

"What is significantly different in this case compared to the unmetallized substrate
is the presence of a zero cutoff TEM mode (Fig. 4). "

We could, I suppose, apply a sharp impulse to the cuvette, just like was done in the simulation,
and then measure the freq. distribution on the far end. Good luck with that.

Can't have parallel plate modes if there's no ground plane! 

The platonic ideal of the gcwg doesn't have a ground plane. Using a ground plane and via fencing
greatly reduces crosstalk bwetween traces, but that shouldn't be an issue here.

The "0.2mm" gap is really closer to 0.3 mm, but that's still only 60Z - shouldn't be too bad.
Should probably reduce the cutting depth to -0.06 or something.

Coplanar waveguide seems to work great for exposure electric fields.

It's probably better to AC-couple in series and then put the diode directly on the microstrip.
we'll get a little less distortion that way probably

Could add a ground plane after!

Add alignment corners

Loss on this cpwg is 2 dB over the 50 mm. That's killer!

With tiny little microwells, however, we can probably drop that down to a few mm.

A 1 mm uwell filled to 0.63 

little a circular patch makes a wideband antenna:
https://ieeexplore-ieee-org.ezproxy.library.yorku.ca/stamp/stamp.jsp?tp=&arnumber=1461127

circular defect in the ground plane?

fluid in the high-field gap?

Punching a 0.9mm hole in polyprop is totally possible.
It certainly is gummy, but not too gummy.
However, filling it is just as hard as with the microchannel.

Just stop the microstrip! it'll radiate from the end! - 
nope, not more effectively.

interditigtated electrode for high field

Simple waveguide applicators look good.



Found an analog devices amp, the HMC996- this is the amp of my dreams!

remember the polyfuse!


There's a "BCA protein assay" that changes color - but isn't specific to live cells.
The plaque assay for covid looks pretty hard.

There don't seem to be any standards for designing equipment for use in BSL-3.

Leaking samples seems to be a big problem. We definitely don't want to cause any safety issues,
so we should be sure that 

0.8 mm

 eeproms with 'industrial scale' seem to be fine at 125c? Voice recorder?

"gel loading" pipette tips have specified sizes. 
"ultra micropoint"
mcmcrrr 	6500T51	

732-12023-1-ND‎
‎155124RS73200A‎
Würth Elektronik
LED RED CLEAR 1206 SMD R/A


"Some amplifiers will have multiple stages, so each stage will need to be biased separately."


"This procedure assumes the amplifi er under test is a part that
requires a dual supply; a positive supply for the drain-source and
a negative supply for the gate-source. If there are multiple gate
controls it is assumed for this procedure that they are connected
together. Use knob style voltage power supplies – not key pad
entry types. The supplies should be used in a fl oating manner
with no connection to the supply ground terminal"


The lung is not directly connected to the chest cavity. We should compute how much power
is reflected from that interface - and can a phased-array compensate for that?

there are "needle microwave probes" - invasive, but treat 2cm areas; probe radiators,

the analog trace coming back to the teensy seems to be suceptible

how do we maintain spring pressure? Thumbscrews might work, but might tear gloves
wing head screws. bingo.

As yet there is no data on dielectric spectroscopy of SARS-NCoV.

new fav. "majestic tech:" chloralkali cell halls. 

Delectric loaded waveguides can provide greater specificity

use DC coupling to determine capacitance?

TDS, pulse spectroscopy, would probably be a cheaper way of doing this. However,
it doesn't allow us to measure the inactivation thresholds over many cycles.
A SY58051AU makes a nice and fast pulse, many GHz. https://www.fetchmodus.org/projects/risetime/
TDS is apparently better, see 
\cite{Time2003a}

"A rapidly increasing voltage step V tŽ . is applied to the 0
line and recorded, along with the reflected voltage R tŽ .
returned from the sample and delayed by the cable propagation time Figure 2 . Any cable or instrument artifacts Ž .
are separated from the sample response due to the propagation delay, thus making them easy to identify and control. The entire frequency spectrum is captured at once,
thus eliminating drift and distortion between frequencies."

"MATFIT from"

the "can't open pdf" problem seems to be the result of the cache folder filling up.
The maximum size of the cache is calculated as a percentage of available disk space.

 --disk-cache-size=xxx (in bytes) aha!


https://www.linuxliteos.com/forums/other/how-to-limit-chromium-browser's-cache-size/
sudo nano /etc/chromium-browser/default
CHROMIUM_FLAGS="--disk-cache-size=52428800 --disk-cache-dir=$HOME/Desktop/chromium-cache"

--aggressive-cache-discard


That was pretty dumb. I was looking at noise sources, freq. combs, broadband this and that,
but the answer was a simple logic gate!

sampling oscilloscope time-domain spectorcopy

fast rail-to-rail current-mode logic
(CML)

Delay-line 
For acquiring the reflected signal an 8-bit analogto-digital converter is used, driven by the THS4509
differential operational amplifier (OA).

" Since the acquisition period is not
an important parameter regarding the sampling
frequency, this AOC is not required to operate at high
speed, but only with a small acquisition time. In our
implementation we have chosen AOS830, which can
operate at a maximum frequency of 60[MHz] with a
full-scale step acquisition time of 2,5[ns]."

Sample-and-hold?


SY89295UMG delay line, 1024 taps, 10 ps resolution!

Needs a fast op-amp. Seems like you could just sum the two voltage signals and sample?
Then you can use a slow ADC, take as long as you want.

Hmm, seems like the sampling technique just shifts the problem to "how do you window such 
a fast signal."
https://hackaday.io/project/167292-8-ghz-sampling-oscilloscope


"
A slight note on the FFT (I got trolled by this in my thesis): Before running FFT on the signal acquired by TDR with step generator, differentiate the data first, then run the FFT, then the calibration and then IFFT and integrate the output. Without the differentiation, you get massive spectral leakage. Then, windowing and zero padding is practically unnecessary unless you want to improve the spectral resolution.
"

ooh, a latched comparator as the sampler. That's neat.



Got the pipette, a "topette" brand. Really nice quality for $70!
Reverse pipetting might be needed.
0.1 uL is unreasonably small. 0.25 is fine.
The 10 uL tips are about 0.85 mm in diameter.

The detuned-vernier technique of \cite{16psresolution2003} is really amazing.
No need for a delay line!

I don't know how it.is got this tool to work so fast. It's amazing!

PMA RT-qPCR can quantify 

The lung is far more spongy that I had presumed!
Fill gaps with paraffin dielectric

Wow, the discontinuity between fat and muscle dielectric is huge! It's way easier to get
through fat!

Thermoacoustic

The heart is right there! Will the pulse affect the heart?

Waveguide exposers have the disadvantage of being narrow-spectrum.

The SY100 /4 downconverter didn't really work very well. 

We need to pulse the HMC996 output. We could do this by just pulsing the power to the HMC732 VCO.
I'm not sure that's a good idea, however. 
The 996 has a power modulation pin ostensibly for this purpose; but it requires -4.5v.
That means we need a fast voltage inverter (?), which I don't have on hand.
Probably something like a differential driver 

mosfet: 
"Using negative voltage will increase turn-on delay time not the actual turn-on rise time. It will decrease turn-off delay time as there will be a higher voltage difference to pull the gate voltage below the threshold."

 hc.meddevices-instrumentsmed.sc@canada.ca is probably the best place to ask 
https://www.canada.ca/en/health-canada/services/drugs-health-products/covid19-industry/medical-devices/testing.html

 Handles should be added to the cuvette to make it easier to move around on the board.

 O ring gasket

Abbot PCR test lists that: 
"Pipettes with aerosol barrier tips or disposable transfer pipettes are used for all pipetting. ""

Looks like bio-cabinets often have internal outlets.

Abbott recommends filter-pipettes for all pipetting.

Put the well plate into a big falcon tube to keep sterile?

The coplanar waveguide more closely approximates a buried or embedded coplanar waveguide at the cuvette.
described in \cite{Characteristics1997}

We should actually see the envelope breaking on an oscillograph of the pulse. There should be 
a non-repeatable dip in the pulse envelope on the first shot.

Could put kapton on after probing as a soldermask 

For prototyping, minimize orthogonality. For production, maximize.

Wow, these pins are made of "Poly liquid crystal". That's pretty neat!


More from the texas people! 

Mention that this has nothing to do with the purely pseudoscientific field of microwave resonance
techniques.

The total amount of energy delivered is equivalent to [a ladybug bumping into one's chest?]

'fdtd' was very helpful in that its first-class python API.

Single sinusoidal pulses with phases 

https://www.uthscsa.edu/academics/biomedical-sciences/faculty/profile/68246/Vijayalaxmi%2C-Vijayalaxmi

Yknow, if the cuvette is properly sealed, there really isn't any risk to the user.

The 467MP doesn't bond to polyprop.

Should make the turbidimeter as two boards, since we don't need the thing in the incubator anymore.

Notched swing bar on screws as preload

bar graph - perfect?

talk to sociologist regarding introduction section

Repeat line from bronchi

Make a laminated card that lines up with the cuvette and tells you what to put where

Aha! Print numbers on the cover film!

 mention how useful the 2.2k rf choked grounded-leg probe was

 record millis() along with other columns.

 something tripped out on a long 10-second max power test.

 pulse at every frequency.


Dynamic biasing with frequency has no effect on the output power.